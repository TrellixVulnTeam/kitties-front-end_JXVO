{"ast":null,"code":"import _slicedToArray from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _classPrivateFieldLooseBase from \"@babel/runtime/helpers/esm/classPrivateFieldLooseBase\";\nimport _classPrivateFieldLooseKey from \"@babel/runtime/helpers/esm/classPrivateFieldLooseKey\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n} // Copyright 2017-2021 @polkadot/api authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nimport { BehaviorSubject, combineLatest, map, of, switchMap, tap, toArray } from 'rxjs';\nimport { decorateDerive } from '@polkadot/api-derive';\nimport { memo, RpcCore } from '@polkadot/rpc-core';\nimport { WsProvider } from '@polkadot/rpc-provider';\nimport { expandMetadata, TypeRegistry, unwrapStorageType } from '@polkadot/types';\nimport { arrayChunk, arrayFlatten, assert, BN, BN_ZERO, compactStripLength, logger, u8aToHex } from '@polkadot/util';\nimport { createSubmittable } from \"../submittable/index.js\";\nimport { augmentObject } from \"../util/augmentObject.js\";\nimport { decorateSections } from \"../util/decorate.js\";\nimport { extractStorageArgs } from \"../util/validate.js\";\nimport { Events } from \"./Events.js\"; // the max amount of keys/values that we will retrieve at once\n\nvar PAGE_SIZE_K = 1000; // limit aligned with the 1k on the node (trie lookups are heavy)\n\nvar PAGE_SIZE_V = 250; // limited since the data may be very large (e.g. misfiring elections)\n\nvar l = logger('api/init');\nvar instanceCounter = 0;\n\nvar _instanceId = /*#__PURE__*/_classPrivateFieldLooseKey(\"instanceId\");\n\nvar _registry = /*#__PURE__*/_classPrivateFieldLooseKey(\"registry\");\n\nexport var Decorate = /*#__PURE__*/function (_Events) {\n  _inherits(Decorate, _Events);\n\n  var _super = _createSuper(Decorate);\n\n  // HACK Use BN import so decorateDerive works... yes, wtf.\n  // latest extrinsic version\n\n  /**\n   * This is the one and only method concrete children classes need to implement.\n   * It's a higher-order function, which takes one argument\n   * `method: Method extends (...args: any[]) => Observable<any>`\n   * (and one optional `options`), and should return the user facing method.\n   * For example:\n   * - For ApiRx, `decorateMethod` should just be identity, because the input\n   * function is already an Observable\n   * - For ApiPromise, `decorateMethod` should return a function that takes all\n   * the parameters from `method`, adds an optional `callback` argument, and\n   * returns a Promise.\n   *\n   * We could easily imagine other user-facing interfaces, which are simply\n   * implemented by transforming the Observable to Stream/Iterator/Kefir/Bacon\n   * via `decorateMethod`.\n   */\n\n  /**\n   * @description Create an instance of the class\n   *\n   * @param options Options object to create API instance or a Provider instance\n   *\n   * @example\n   * <BR>\n   *\n   * ```javascript\n   * import Api from '@polkadot/api/promise';\n   *\n   * const api = new Api().isReady();\n   *\n   * api.rpc.subscribeNewHeads((header) => {\n   *   console.log(`new block #${header.number.toNumber()}`);\n   * });\n   * ```\n   */\n  function Decorate(options, type, decorateMethod) {\n    var _this;\n\n    _classCallCheck(this, Decorate);\n\n    var _options$source;\n\n    _this = _super.call(this);\n    Object.defineProperty(_assertThisInitialized(_this), _instanceId, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_assertThisInitialized(_this), _registry, {\n      writable: true,\n      value: void 0\n    });\n    _this.__phantom = new BN(0);\n    _this._consts = {};\n    _this._derive = void 0;\n    _this._errors = {};\n    _this._events = {};\n    _this._extrinsics = void 0;\n    _this._extrinsicType = 4;\n    _this._genesisHash = void 0;\n    _this._isConnected = void 0;\n    _this._isReady = false;\n    _this._options = void 0;\n    _this._query = {};\n    _this._queryMulti = void 0;\n    _this._rpc = void 0;\n    _this._rpcCore = void 0;\n    _this._runtimeChain = void 0;\n    _this._runtimeMetadata = void 0;\n    _this._runtimeVersion = void 0;\n    _this._rx = {\n      consts: {},\n      query: {},\n      tx: {}\n    };\n    _this._type = void 0;\n    _this._decorateMethod = void 0;\n\n    _this._rxDecorateMethod = function (method) {\n      return method;\n    };\n\n    _classPrivateFieldLooseBase(_assertThisInitialized(_this), _instanceId)[_instanceId] = \"\".concat(++instanceCounter);\n    _classPrivateFieldLooseBase(_assertThisInitialized(_this), _registry)[_registry] = ((_options$source = options.source) === null || _options$source === void 0 ? void 0 : _options$source.registry) || options.registry || new TypeRegistry();\n    _this._rx.registry = _classPrivateFieldLooseBase(_assertThisInitialized(_this), _registry)[_registry];\n    var thisProvider = options.source ? options.source._rpcCore.provider.clone() : options.provider || new WsProvider();\n    _this._decorateMethod = decorateMethod;\n    _this._options = options;\n    _this._type = type; // The RPC interface decorates the known interfaces on init\n\n    _this._rpcCore = new RpcCore(_classPrivateFieldLooseBase(_assertThisInitialized(_this), _instanceId)[_instanceId], _classPrivateFieldLooseBase(_assertThisInitialized(_this), _registry)[_registry], thisProvider, _this._options.rpc);\n    _this._isConnected = new BehaviorSubject(_this._rpcCore.provider.isConnected);\n    _this._rx.hasSubscriptions = _this._rpcCore.provider.hasSubscriptions;\n    return _this;\n  }\n  /**\n   * @description Return the current used registry\n   */\n\n\n  _createClass(Decorate, [{\n    key: \"registry\",\n    get: function get() {\n      return _classPrivateFieldLooseBase(this, _registry)[_registry];\n    }\n    /**\n     * @description Creates an instance of a type as registered\n     */\n\n  }, {\n    key: \"createType\",\n    value: function createType(type) {\n      var _classPrivateFieldLoo;\n\n      for (var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        params[_key - 1] = arguments[_key];\n      }\n\n      return (_classPrivateFieldLoo = _classPrivateFieldLooseBase(this, _registry)[_registry]).createType.apply(_classPrivateFieldLoo, [type].concat(params));\n    }\n    /**\n     * @description Register additional user-defined of chain-specific types in the type registry\n     */\n\n  }, {\n    key: \"registerTypes\",\n    value: function registerTypes(types) {\n      types && _classPrivateFieldLooseBase(this, _registry)[_registry].register(types);\n    }\n    /**\n     * @returns `true` if the API operates with subscriptions\n     */\n\n  }, {\n    key: \"hasSubscriptions\",\n    get: function get() {\n      return this._rpcCore.provider.hasSubscriptions;\n    }\n    /**\n     * @returns `true` if the API decorate multi-key queries\n     */\n\n  }, {\n    key: \"supportMulti\",\n    get: function get() {\n      return this._rpcCore.provider.hasSubscriptions || !!this._rpcCore.state.queryStorageAt;\n    }\n  }, {\n    key: \"_createDecorated\",\n    value: function _createDecorated(registry, fromEmpty, blockHash, decoratedApi) {\n      if (!decoratedApi) {\n        decoratedApi = {\n          consts: {},\n          errors: {},\n          events: {},\n          query: {}\n        };\n      }\n\n      if (!registry.decoratedMeta) {\n        registry.decoratedMeta = expandMetadata(registry.registry, registry.metadata);\n      } // adjust the versioned registry\n\n\n      augmentObject('consts', registry.decoratedMeta.consts, decoratedApi.consts, fromEmpty);\n      augmentObject('errors', registry.decoratedMeta.errors, decoratedApi.errors, fromEmpty);\n      augmentObject('events', registry.decoratedMeta.events, decoratedApi.events, fromEmpty);\n      var storage = blockHash ? this._decorateStorageAt(registry.decoratedMeta, this._decorateMethod, blockHash) : this._decorateStorage(registry.decoratedMeta, this._decorateMethod);\n      augmentObject('query', storage, decoratedApi.query, fromEmpty);\n      return {\n        decoratedApi: decoratedApi,\n        decoratedMeta: registry.decoratedMeta\n      };\n    }\n  }, {\n    key: \"_injectMetadata\",\n    value: function _injectMetadata(registry, fromEmpty) {\n      // clear the decoration, we are redoing it here\n      if (fromEmpty || !registry.decoratedApi) {\n        registry.decoratedApi = {\n          consts: {},\n          errors: {},\n          events: {},\n          query: {}\n        };\n      }\n\n      var _this$_createDecorate = this._createDecorated(registry, fromEmpty, null, registry.decoratedApi),\n          decoratedApi = _this$_createDecorate.decoratedApi,\n          decoratedMeta = _this$_createDecorate.decoratedMeta;\n\n      this._consts = decoratedApi.consts;\n      this._errors = decoratedApi.errors;\n      this._events = decoratedApi.events;\n      this._query = decoratedApi.query;\n\n      if (fromEmpty || !this._extrinsics) {\n        this._extrinsics = this._decorateExtrinsics(decoratedMeta, this._decorateMethod);\n        this._rx.tx = this._decorateExtrinsics(decoratedMeta, this._rxDecorateMethod);\n      } else {\n        augmentObject('tx', this._decorateExtrinsics(decoratedMeta, this._decorateMethod), this._extrinsics, false);\n        augmentObject(null, this._decorateExtrinsics(decoratedMeta, this._rxDecorateMethod), this._rx.tx, false);\n      } // rx\n\n\n      augmentObject(null, this._decorateStorage(decoratedMeta, this._rxDecorateMethod), this._rx.query, fromEmpty);\n      augmentObject(null, decoratedMeta.consts, this._rx.consts, fromEmpty);\n    }\n    /**\n     * @deprecated\n     * backwards compatible endpoint for metadata injection, may be removed in the future (However, it is still useful for testing injection)\n     */\n\n  }, {\n    key: \"injectMetadata\",\n    value: function injectMetadata(metadata, fromEmpty, registry) {\n      this._injectMetadata({\n        metadata: metadata,\n        registry: registry || _classPrivateFieldLooseBase(this, _registry)[_registry],\n        specName: _classPrivateFieldLooseBase(this, _registry)[_registry].createType('Text'),\n        specVersion: BN_ZERO\n      }, fromEmpty);\n    }\n  }, {\n    key: \"_decorateFunctionMeta\",\n    value: function _decorateFunctionMeta(input, output) {\n      output.meta = input.meta;\n      output.method = input.method;\n      output.section = input.section;\n      output.toJSON = input.toJSON;\n\n      if (input.callIndex) {\n        output.callIndex = input.callIndex;\n      }\n\n      return output;\n    } // Filter all RPC methods based on the results of the rpc_methods call. We do this in the following\n    // manner to cater for both old and new:\n    //   - when the number of entries are 0, only remove the ones with isOptional (account & contracts)\n    //   - when non-zero, remove anything that is not in the array (we don't do this)\n\n  }, {\n    key: \"_filterRpc\",\n    value: function _filterRpc(methods, additional) {\n      // add any specific user-base RPCs\n      if (Object.keys(additional).length !== 0) {\n        this._rpcCore.addUserInterfaces(additional); // re-decorate, only adding any new additional interfaces\n\n\n        this._decorateRpc(this._rpcCore, this._decorateMethod, this._rpc);\n\n        this._decorateRpc(this._rpcCore, this._rxDecorateMethod, this._rx.rpc);\n      }\n\n      this._filterRpcMethods(methods);\n    }\n  }, {\n    key: \"_filterRpcMethods\",\n    value: function _filterRpcMethods(exposed) {\n      var _this2 = this;\n\n      var hasResults = exposed.length !== 0;\n\n      var allKnown = _toConsumableArray(this._rpcCore.mapping.entries());\n\n      var allKeys = allKnown.reduce(function (allKeys, _ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            _ref2$ = _ref2[1],\n            alias = _ref2$.alias,\n            endpoint = _ref2$.endpoint,\n            method = _ref2$.method,\n            pubsub = _ref2$.pubsub,\n            section = _ref2$.section;\n\n        allKeys.push(\"\".concat(section, \"_\").concat(method));\n\n        if (pubsub) {\n          allKeys.push(\"\".concat(section, \"_\").concat(pubsub[1]));\n          allKeys.push(\"\".concat(section, \"_\").concat(pubsub[2]));\n        }\n\n        if (alias) {\n          allKeys.push.apply(allKeys, _toConsumableArray(alias));\n        }\n\n        if (endpoint) {\n          allKeys.push(endpoint);\n        }\n\n        return allKeys;\n      }, []);\n      var unknown = exposed.filter(function (k) {\n        return !allKeys.includes(k);\n      });\n      var deletion = allKnown.filter(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 1),\n            k = _ref4[0];\n\n        return hasResults && !exposed.includes(k) && k !== 'rpc_methods';\n      });\n\n      if (unknown.length) {\n        l.warn(\"RPC methods not decorated: \".concat(unknown.join(', ')));\n      } // loop through all entries we have (populated in decorate) and filter as required\n      // only remove when we have results and method missing, or with no results if optional\n\n\n      deletion.forEach(function (_ref5) {\n        var _ref6 = _slicedToArray(_ref5, 2),\n            _ref6$ = _ref6[1],\n            method = _ref6$.method,\n            section = _ref6$.section;\n\n        delete _this2._rpc[section][method];\n        delete _this2._rx.rpc[section][method];\n      });\n    }\n  }, {\n    key: \"_decorateRpc\",\n    value: function _decorateRpc(rpc, decorateMethod) {\n      var _this3 = this;\n\n      var input = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      return rpc.sections.reduce(function (out, _sectionName) {\n        var sectionName = _sectionName;\n\n        if (!out[sectionName]) {\n          // out and section here are horrors to get right from a typing perspective :(\n          out[sectionName] = Object.entries(rpc[sectionName]).reduce(function (section, _ref7) {\n            var _ref8 = _slicedToArray(_ref7, 2),\n                methodName = _ref8[0],\n                method = _ref8[1];\n\n            //  skip subscriptions where we have a non-subscribe interface\n            if (_this3.hasSubscriptions || !(methodName.startsWith('subscribe') || methodName.startsWith('unsubscribe'))) {\n              section[methodName] = decorateMethod(method, {\n                methodName: methodName\n              }); // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\n              section[methodName].json = decorateMethod(method.json, {\n                methodName: methodName\n              }); // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\n              section[methodName].raw = decorateMethod(method.raw, {\n                methodName: methodName\n              }); // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\n              section[methodName].meta = method.meta;\n            }\n\n            return section;\n          }, {});\n        }\n\n        return out;\n      }, input);\n    } // only be called if supportMulti is true\n\n  }, {\n    key: \"_decorateMulti\",\n    value: function _decorateMulti(decorateMethod) {\n      var _this4 = this;\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return decorateMethod(function (calls) {\n        return (_this4.hasSubscriptions ? _this4._rpcCore.state.subscribeStorage : _this4._rpcCore.state.queryStorageAt)(calls.map(function (arg) {\n          return Array.isArray(arg) ? [arg[0].creator].concat(_toConsumableArray(arg.slice(1))) : [arg.creator];\n        }));\n      });\n    }\n  }, {\n    key: \"_decorateExtrinsics\",\n    value: function _decorateExtrinsics(_ref9, decorateMethod) {\n      var _this5 = this;\n\n      var tx = _ref9.tx;\n      var creator = createSubmittable(this._type, this._rx, decorateMethod);\n      return Object.entries(tx).reduce(function (out, _ref10) {\n        var _ref11 = _slicedToArray(_ref10, 2),\n            name = _ref11[0],\n            section = _ref11[1];\n\n        out[name] = Object.entries(section).reduce(function (out, _ref12) {\n          var _ref13 = _slicedToArray(_ref12, 2),\n              name = _ref13[0],\n              method = _ref13[1];\n\n          out[name] = _this5._decorateExtrinsicEntry(method, creator);\n          return out;\n        }, {});\n        return out;\n      }, creator);\n    }\n  }, {\n    key: \"_decorateExtrinsicEntry\",\n    value: function _decorateExtrinsicEntry(method, creator) {\n      var decorated = function decorated() {\n        return creator(method.apply(void 0, arguments));\n      }; // pass through the `.is`\n\n\n      decorated.is = function (other) {\n        return method.is(other);\n      }; // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\n\n      return this._decorateFunctionMeta(method, decorated);\n    }\n  }, {\n    key: \"_decorateStorage\",\n    value: function _decorateStorage(_ref14, decorateMethod) {\n      var _this6 = this;\n\n      var query = _ref14.query;\n      return Object.entries(query).reduce(function (out, _ref15) {\n        var _ref16 = _slicedToArray(_ref15, 2),\n            name = _ref16[0],\n            section = _ref16[1];\n\n        out[name] = Object.entries(section).reduce(function (out, _ref17) {\n          var _ref18 = _slicedToArray(_ref17, 2),\n              name = _ref18[0],\n              method = _ref18[1];\n\n          out[name] = _this6._decorateStorageEntry(method, decorateMethod);\n          return out;\n        }, {});\n        return out;\n      }, {});\n    }\n  }, {\n    key: \"_decorateStorageAt\",\n    value: function _decorateStorageAt(_ref19, decorateMethod, blockHash) {\n      var _this7 = this;\n\n      var query = _ref19.query;\n      return Object.entries(query).reduce(function (out, _ref20) {\n        var _ref21 = _slicedToArray(_ref20, 2),\n            name = _ref21[0],\n            section = _ref21[1];\n\n        out[name] = Object.entries(section).reduce(function (out, _ref22) {\n          var _ref23 = _slicedToArray(_ref22, 2),\n              name = _ref23[0],\n              method = _ref23[1];\n\n          out[name] = _this7._decorateStorageEntryAt(method, decorateMethod, blockHash);\n          return out;\n        }, {});\n        return out;\n      }, {});\n    }\n  }, {\n    key: \"_decorateStorageEntry\",\n    value: function _decorateStorageEntry(creator, decorateMethod) {\n      var _this8 = this;\n\n      // get the storage arguments, with DoubleMap as an array entry, otherwise spread\n      var getArgs = function getArgs(args) {\n        return extractStorageArgs(_classPrivateFieldLooseBase(_this8, _registry)[_registry], creator, args);\n      }; // Disable this where it occurs for each field we are decorating\n\n      /* eslint-disable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n      var decorated = this._decorateStorageCall(creator, decorateMethod);\n\n      decorated.creator = creator;\n      decorated.at = decorateMethod(function (hash) {\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        return _this8._rpcCore.state.getStorage(getArgs(args), hash);\n      });\n      decorated.hash = decorateMethod(function () {\n        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n          args[_key3] = arguments[_key3];\n        }\n\n        return _this8._rpcCore.state.getStorageHash(getArgs(args));\n      });\n\n      decorated.is = function (key) {\n        return key.section === creator.section && key.method === creator.method;\n      };\n\n      decorated.key = function () {\n        for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n          args[_key4] = arguments[_key4];\n        }\n\n        return u8aToHex(compactStripLength(creator(creator.meta.type.isPlain ? undefined : creator.meta.type.isMap ? args[0] : creator.meta.type.isDoubleMap ? [args[0], args[1]] : args))[1]);\n      };\n\n      decorated.keyPrefix = function () {\n        return u8aToHex(creator.keyPrefix.apply(creator, arguments));\n      };\n\n      decorated.range = decorateMethod(function (range) {\n        for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n          args[_key5 - 1] = arguments[_key5];\n        }\n\n        return _this8._decorateStorageRange(decorated, args, range);\n      });\n      decorated.size = decorateMethod(function () {\n        for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n          args[_key6] = arguments[_key6];\n        }\n\n        return _this8._rpcCore.state.getStorageSize(getArgs(args));\n      });\n      decorated.sizeAt = decorateMethod(function (hash) {\n        for (var _len7 = arguments.length, args = new Array(_len7 > 1 ? _len7 - 1 : 0), _key7 = 1; _key7 < _len7; _key7++) {\n          args[_key7 - 1] = arguments[_key7];\n        }\n\n        return _this8._rpcCore.state.getStorageSize(getArgs(args), hash);\n      }); // FIXME NMap support\n      // .keys() & .entries() only available on map types\n\n      if (creator.iterKey && (creator.meta.type.isMap || creator.meta.type.isDoubleMap || creator.meta.type.isNMap)) {\n        decorated.entries = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function () {\n          for (var _len8 = arguments.length, args = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n            args[_key8] = arguments[_key8];\n          }\n\n          return _this8._retrieveMapEntries(creator, null, args);\n        }));\n        decorated.entriesAt = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function (hash) {\n          for (var _len9 = arguments.length, args = new Array(_len9 > 1 ? _len9 - 1 : 0), _key9 = 1; _key9 < _len9; _key9++) {\n            args[_key9 - 1] = arguments[_key9];\n          }\n\n          return _this8._retrieveMapEntries(creator, hash, args);\n        }));\n        decorated.entriesPaged = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function (opts) {\n          return _this8._retrieveMapEntriesPaged(creator, opts);\n        }));\n        decorated.keys = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function () {\n          for (var _len10 = arguments.length, args = new Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {\n            args[_key10] = arguments[_key10];\n          }\n\n          return _this8._retrieveMapKeys(creator, null, args);\n        }));\n        decorated.keysAt = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function (hash) {\n          for (var _len11 = arguments.length, args = new Array(_len11 > 1 ? _len11 - 1 : 0), _key11 = 1; _key11 < _len11; _key11++) {\n            args[_key11 - 1] = arguments[_key11];\n          }\n\n          return _this8._retrieveMapKeys(creator, hash, args);\n        }));\n        decorated.keysPaged = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function (opts) {\n          return _this8._retrieveMapKeysPaged(creator, opts);\n        }));\n      }\n\n      if (this.supportMulti) {\n        // When using double map storage function, user need to pass double map key as an array\n        decorated.multi = decorateMethod(function (args) {\n          return _this8._retrieveMulti(args.map(function (arg) {\n            return [creator, arg];\n          }));\n        });\n      }\n      /* eslint-enable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n      return this._decorateFunctionMeta(creator, decorated);\n    }\n  }, {\n    key: \"_decorateStorageEntryAt\",\n    value: function _decorateStorageEntryAt(creator, decorateMethod, blockHash) {\n      var _this9 = this;\n\n      // get the storage arguments, with DoubleMap as an array entry, otherwise spread\n      var getArgs = function getArgs(args) {\n        return extractStorageArgs(_classPrivateFieldLooseBase(_this9, _registry)[_registry], creator, args);\n      }; // Disable this where it occurs for each field we are decorating\n\n      /* eslint-disable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n      var decorated = decorateMethod(function () {\n        for (var _len12 = arguments.length, args = new Array(_len12), _key12 = 0; _key12 < _len12; _key12++) {\n          args[_key12] = arguments[_key12];\n        }\n\n        return _this9._rpcCore.state.getStorage(getArgs(args), blockHash);\n      });\n      decorated.creator = creator;\n      decorated.hash = decorateMethod(function () {\n        for (var _len13 = arguments.length, args = new Array(_len13), _key13 = 0; _key13 < _len13; _key13++) {\n          args[_key13] = arguments[_key13];\n        }\n\n        return _this9._rpcCore.state.getStorageHash(getArgs(args), blockHash);\n      });\n\n      decorated.is = function (key) {\n        return key.section === creator.section && key.method === creator.method;\n      };\n\n      decorated.key = function () {\n        for (var _len14 = arguments.length, args = new Array(_len14), _key14 = 0; _key14 < _len14; _key14++) {\n          args[_key14] = arguments[_key14];\n        }\n\n        return u8aToHex(compactStripLength(creator(creator.meta.type.isPlain ? undefined : creator.meta.type.isMap ? args[0] : creator.meta.type.isDoubleMap ? [args[0], args[1]] : args))[1]);\n      };\n\n      decorated.keyPrefix = function () {\n        return u8aToHex(creator.keyPrefix.apply(creator, arguments));\n      };\n\n      decorated.size = decorateMethod(function () {\n        for (var _len15 = arguments.length, args = new Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n          args[_key15] = arguments[_key15];\n        }\n\n        return _this9._rpcCore.state.getStorageSize(getArgs(args), blockHash);\n      }); // FIXME NMap support\n      // .keys() & .entries() only available on map types\n\n      if (creator.iterKey && (creator.meta.type.isMap || creator.meta.type.isDoubleMap)) {\n        decorated.entries = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function () {\n          for (var _len16 = arguments.length, args = new Array(_len16), _key16 = 0; _key16 < _len16; _key16++) {\n            args[_key16] = arguments[_key16];\n          }\n\n          return _this9._retrieveMapEntries(creator, blockHash, args);\n        }));\n        decorated.keys = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], function () {\n          for (var _len17 = arguments.length, args = new Array(_len17), _key17 = 0; _key17 < _len17; _key17++) {\n            args[_key17] = arguments[_key17];\n          }\n\n          return _this9._retrieveMapKeys(creator, blockHash, args);\n        }));\n      }\n      /* eslint-enable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n      return this._decorateFunctionMeta(creator, decorated);\n    } // Decorate the base storage call. In the case or rxjs or promise-without-callback (await)\n    // we make a subscription, alternatively we push this through a single-shot query\n\n  }, {\n    key: \"_decorateStorageCall\",\n    value: function _decorateStorageCall(creator, decorateMethod) {\n      var _this10 = this;\n\n      return decorateMethod(function () {\n        for (var _len18 = arguments.length, args = new Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n          args[_key18] = arguments[_key18];\n        }\n\n        return _this10.hasSubscriptions ? _this10._rpcCore.state.subscribeStorage([extractStorageArgs(_classPrivateFieldLooseBase(_this10, _registry)[_registry], creator, args)]).pipe(map(function (_ref24) {\n          var _ref25 = _slicedToArray(_ref24, 1),\n              data = _ref25[0];\n\n          return data;\n        }) // extract first/only result from list\n        ) : _this10._rpcCore.state.getStorage(extractStorageArgs(_classPrivateFieldLooseBase(_this10, _registry)[_registry], creator, args));\n      }, {\n        methodName: creator.method,\n        overrideNoSub: function overrideNoSub() {\n          for (var _len19 = arguments.length, args = new Array(_len19), _key19 = 0; _key19 < _len19; _key19++) {\n            args[_key19] = arguments[_key19];\n          }\n\n          return _this10._rpcCore.state.getStorage(extractStorageArgs(_classPrivateFieldLooseBase(_this10, _registry)[_registry], creator, args));\n        }\n      });\n    }\n  }, {\n    key: \"_decorateStorageRange\",\n    value: function _decorateStorageRange(decorated, args, range) {\n      var _this$_rpcCore$state,\n          _this11 = this;\n\n      var outputType = unwrapStorageType(_classPrivateFieldLooseBase(this, _registry)[_registry], decorated.creator.meta.type, decorated.creator.meta.modifier.isOptional);\n      return (_this$_rpcCore$state = this._rpcCore.state).queryStorage.apply(_this$_rpcCore$state, [[decorated.key.apply(decorated, _toConsumableArray(args))]].concat(_toConsumableArray(range))).pipe(map(function (result) {\n        return result.map(function (_ref26) {\n          var _ref27 = _slicedToArray(_ref26, 2),\n              blockHash = _ref27[0],\n              _ref27$ = _slicedToArray(_ref27[1], 1),\n              value = _ref27$[0];\n\n          return [blockHash, _this11.createType(outputType, value.isSome ? value.unwrap().toHex() : undefined)];\n        });\n      }));\n    } // retrieve a set of values for a specific set of keys - here we chunk the keys into PAGE_SIZE sizes\n\n  }, {\n    key: \"_retrieveMulti\",\n    value: function _retrieveMulti(keys) {\n      if (!keys.length) {\n        return of([]);\n      }\n\n      var queryCall = this.hasSubscriptions ? this._rpcCore.state.subscribeStorage : this._rpcCore.state.queryStorageAt;\n      return combineLatest(arrayChunk(keys, PAGE_SIZE_V).map(function (keys) {\n        return queryCall(keys);\n      })).pipe(map(arrayFlatten));\n    }\n  }, {\n    key: \"_retrieveMapKeys\",\n    value: function _retrieveMapKeys(_ref28, at, args) {\n      var _this12 = this;\n\n      var iterKey = _ref28.iterKey,\n          meta = _ref28.meta,\n          method = _ref28.method,\n          section = _ref28.section;\n      assert(iterKey && (meta.type.isMap || meta.type.isDoubleMap || meta.type.isNMap), 'keys can only be retrieved on maps, linked maps and double maps');\n      var headKey = iterKey.apply(void 0, _toConsumableArray(args)).toHex();\n      var startSubject = new BehaviorSubject(headKey);\n      var queryCall = at ? function (startKey) {\n        return _this12._rpcCore.state.getKeysPaged(headKey, PAGE_SIZE_K, startKey, at);\n      } : function (startKey) {\n        return _this12._rpcCore.state.getKeysPaged(headKey, PAGE_SIZE_K, startKey);\n      };\n      return startSubject.pipe(switchMap(queryCall), map(function (keys) {\n        return keys.map(function (key) {\n          return key.setMeta(meta, section, method);\n        });\n      }), tap(function (keys) {\n        setTimeout(function () {\n          keys.length === PAGE_SIZE_K ? startSubject.next(keys[PAGE_SIZE_K - 1].toHex()) : startSubject.complete();\n        }, 0);\n      }), toArray(), // toArray since we want to startSubject to be completed\n      map(arrayFlatten));\n    }\n  }, {\n    key: \"_retrieveMapKeysPaged\",\n    value: function _retrieveMapKeysPaged(_ref29, opts) {\n      var iterKey = _ref29.iterKey,\n          meta = _ref29.meta,\n          method = _ref29.method,\n          section = _ref29.section;\n      assert(iterKey && (meta.type.isMap || meta.type.isDoubleMap || meta.type.isNMap), 'keys can only be retrieved on maps, linked maps and double maps');\n      var headKey = iterKey.apply(void 0, _toConsumableArray(opts.args)).toHex();\n      return this._rpcCore.state.getKeysPaged(headKey, opts.pageSize, opts.startKey || headKey).pipe(map(function (keys) {\n        return keys.map(function (key) {\n          return key.setMeta(meta, section, method);\n        });\n      }));\n    }\n  }, {\n    key: \"_retrieveMapEntries\",\n    value: function _retrieveMapEntries(entry, at, args) {\n      var _this13 = this;\n\n      var query = at ? function (keyset) {\n        return _this13._rpcCore.state.queryStorageAt(keyset, at);\n      } : function (keyset) {\n        return _this13._rpcCore.state.queryStorageAt(keyset);\n      };\n      return this._retrieveMapKeys(entry, at, args).pipe(switchMap(function (keys) {\n        return keys.length ? combineLatest(arrayChunk(keys, PAGE_SIZE_V).map(query)).pipe(map(function (valsArr) {\n          return arrayFlatten(valsArr).map(function (value, index) {\n            return [keys[index], value];\n          });\n        })) : of([]);\n      }));\n    }\n  }, {\n    key: \"_retrieveMapEntriesPaged\",\n    value: function _retrieveMapEntriesPaged(entry, opts) {\n      var _this14 = this;\n\n      return this._retrieveMapKeysPaged(entry, opts).pipe(switchMap(function (keys) {\n        return keys.length ? _this14._rpcCore.state.queryStorageAt(keys).pipe(map(function (valsArr) {\n          return valsArr.map(function (value, index) {\n            return [keys[index], value];\n          });\n        })) : of([]);\n      }));\n    }\n  }, {\n    key: \"_decorateDeriveRx\",\n    value: function _decorateDeriveRx(decorateMethod) {\n      var _this$_runtimeVersion, _this$_options$typesB, _this$_options$typesB2, _this$_options$typesB3;\n\n      var specName = (_this$_runtimeVersion = this._runtimeVersion) === null || _this$_runtimeVersion === void 0 ? void 0 : _this$_runtimeVersion.specName.toString();\n\n      var derives = _objectSpread(_objectSpread({}, this._options.derives), ((_this$_options$typesB = this._options.typesBundle) === null || _this$_options$typesB === void 0 ? void 0 : (_this$_options$typesB2 = _this$_options$typesB.spec) === null || _this$_options$typesB2 === void 0 ? void 0 : (_this$_options$typesB3 = _this$_options$typesB2[specName !== null && specName !== void 0 ? specName : '']) === null || _this$_options$typesB3 === void 0 ? void 0 : _this$_options$typesB3.derives) || {}); // Pull in derive from api-derive\n\n\n      var derive = decorateDerive(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], this._rx, derives);\n      return decorateSections(derive, decorateMethod);\n    }\n  }, {\n    key: \"_decorateDerive\",\n    value: function _decorateDerive(decorateMethod) {\n      return decorateSections(this._rx.derive, decorateMethod);\n    }\n    /**\n     * Put the `this.onCall` function of ApiRx here, because it is needed by\n     * `api._rx`.\n     */\n\n  }]);\n\n  return Decorate;\n}(Events);","map":{"version":3,"sources":["/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/@polkadot/api/base/Decorate.js"],"names":["_defineProperty","_classPrivateFieldLooseBase","_classPrivateFieldLooseKey","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","BehaviorSubject","combineLatest","map","of","switchMap","tap","toArray","decorateDerive","memo","RpcCore","WsProvider","expandMetadata","TypeRegistry","unwrapStorageType","arrayChunk","arrayFlatten","assert","BN","BN_ZERO","compactStripLength","logger","u8aToHex","createSubmittable","augmentObject","decorateSections","extractStorageArgs","Events","PAGE_SIZE_K","PAGE_SIZE_V","l","instanceCounter","_instanceId","_registry","Decorate","options","type","decorateMethod","_options$source","writable","value","__phantom","_consts","_derive","_errors","_events","_extrinsics","_extrinsicType","_genesisHash","_isConnected","_isReady","_options","_query","_queryMulti","_rpc","_rpcCore","_runtimeChain","_runtimeMetadata","_runtimeVersion","_rx","consts","query","tx","_type","_decorateMethod","_rxDecorateMethod","method","registry","thisProvider","provider","clone","rpc","isConnected","hasSubscriptions","params","createType","types","register","state","queryStorageAt","fromEmpty","blockHash","decoratedApi","errors","events","decoratedMeta","metadata","storage","_decorateStorageAt","_decorateStorage","_createDecorated","_decorateExtrinsics","_injectMetadata","specName","specVersion","input","output","meta","section","toJSON","callIndex","methods","additional","addUserInterfaces","_decorateRpc","_filterRpcMethods","exposed","hasResults","allKnown","mapping","entries","allKeys","reduce","alias","endpoint","pubsub","unknown","k","includes","deletion","warn","join","sections","out","_sectionName","sectionName","methodName","startsWith","json","raw","calls","subscribeStorage","arg","Array","isArray","creator","slice","name","_decorateExtrinsicEntry","decorated","is","other","_decorateFunctionMeta","_decorateStorageEntry","_decorateStorageEntryAt","getArgs","args","_decorateStorageCall","at","hash","getStorage","getStorageHash","isPlain","undefined","isMap","isDoubleMap","keyPrefix","range","_decorateStorageRange","size","getStorageSize","sizeAt","iterKey","isNMap","_retrieveMapEntries","entriesAt","entriesPaged","opts","_retrieveMapEntriesPaged","_retrieveMapKeys","keysAt","keysPaged","_retrieveMapKeysPaged","supportMulti","multi","_retrieveMulti","pipe","data","overrideNoSub","outputType","modifier","isOptional","queryStorage","result","isSome","unwrap","toHex","queryCall","headKey","startSubject","startKey","getKeysPaged","setMeta","setTimeout","next","complete","pageSize","entry","keyset","valsArr","index","_this$_runtimeVersion","_this$_options$typesB","_this$_options$typesB2","_this$_options$typesB3","toString","derives","typesBundle","spec","derive"],"mappings":"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","sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _classPrivateFieldLooseBase from \"@babel/runtime/helpers/esm/classPrivateFieldLooseBase\";\nimport _classPrivateFieldLooseKey from \"@babel/runtime/helpers/esm/classPrivateFieldLooseKey\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Copyright 2017-2021 @polkadot/api authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { BehaviorSubject, combineLatest, map, of, switchMap, tap, toArray } from 'rxjs';\nimport { decorateDerive } from '@polkadot/api-derive';\nimport { memo, RpcCore } from '@polkadot/rpc-core';\nimport { WsProvider } from '@polkadot/rpc-provider';\nimport { expandMetadata, TypeRegistry, unwrapStorageType } from '@polkadot/types';\nimport { arrayChunk, arrayFlatten, assert, BN, BN_ZERO, compactStripLength, logger, u8aToHex } from '@polkadot/util';\nimport { createSubmittable } from \"../submittable/index.js\";\nimport { augmentObject } from \"../util/augmentObject.js\";\nimport { decorateSections } from \"../util/decorate.js\";\nimport { extractStorageArgs } from \"../util/validate.js\";\nimport { Events } from \"./Events.js\";\n// the max amount of keys/values that we will retrieve at once\nconst PAGE_SIZE_K = 1000; // limit aligned with the 1k on the node (trie lookups are heavy)\n\nconst PAGE_SIZE_V = 250; // limited since the data may be very large (e.g. misfiring elections)\n\nconst l = logger('api/init');\nlet instanceCounter = 0;\n\nvar _instanceId = /*#__PURE__*/_classPrivateFieldLooseKey(\"instanceId\");\n\nvar _registry = /*#__PURE__*/_classPrivateFieldLooseKey(\"registry\");\n\nexport class Decorate extends Events {\n  // HACK Use BN import so decorateDerive works... yes, wtf.\n  // latest extrinsic version\n\n  /**\n   * This is the one and only method concrete children classes need to implement.\n   * It's a higher-order function, which takes one argument\n   * `method: Method extends (...args: any[]) => Observable<any>`\n   * (and one optional `options`), and should return the user facing method.\n   * For example:\n   * - For ApiRx, `decorateMethod` should just be identity, because the input\n   * function is already an Observable\n   * - For ApiPromise, `decorateMethod` should return a function that takes all\n   * the parameters from `method`, adds an optional `callback` argument, and\n   * returns a Promise.\n   *\n   * We could easily imagine other user-facing interfaces, which are simply\n   * implemented by transforming the Observable to Stream/Iterator/Kefir/Bacon\n   * via `decorateMethod`.\n   */\n\n  /**\n   * @description Create an instance of the class\n   *\n   * @param options Options object to create API instance or a Provider instance\n   *\n   * @example\n   * <BR>\n   *\n   * ```javascript\n   * import Api from '@polkadot/api/promise';\n   *\n   * const api = new Api().isReady();\n   *\n   * api.rpc.subscribeNewHeads((header) => {\n   *   console.log(`new block #${header.number.toNumber()}`);\n   * });\n   * ```\n   */\n  constructor(options, type, decorateMethod) {\n    var _options$source;\n\n    super();\n    Object.defineProperty(this, _instanceId, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _registry, {\n      writable: true,\n      value: void 0\n    });\n    this.__phantom = new BN(0);\n    this._consts = {};\n    this._derive = void 0;\n    this._errors = {};\n    this._events = {};\n    this._extrinsics = void 0;\n    this._extrinsicType = 4;\n    this._genesisHash = void 0;\n    this._isConnected = void 0;\n    this._isReady = false;\n    this._options = void 0;\n    this._query = {};\n    this._queryMulti = void 0;\n    this._rpc = void 0;\n    this._rpcCore = void 0;\n    this._runtimeChain = void 0;\n    this._runtimeMetadata = void 0;\n    this._runtimeVersion = void 0;\n    this._rx = {\n      consts: {},\n      query: {},\n      tx: {}\n    };\n    this._type = void 0;\n    this._decorateMethod = void 0;\n\n    this._rxDecorateMethod = method => {\n      return method;\n    };\n\n    _classPrivateFieldLooseBase(this, _instanceId)[_instanceId] = `${++instanceCounter}`;\n    _classPrivateFieldLooseBase(this, _registry)[_registry] = ((_options$source = options.source) === null || _options$source === void 0 ? void 0 : _options$source.registry) || options.registry || new TypeRegistry();\n    this._rx.registry = _classPrivateFieldLooseBase(this, _registry)[_registry];\n    const thisProvider = options.source ? options.source._rpcCore.provider.clone() : options.provider || new WsProvider();\n    this._decorateMethod = decorateMethod;\n    this._options = options;\n    this._type = type; // The RPC interface decorates the known interfaces on init\n\n    this._rpcCore = new RpcCore(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], _classPrivateFieldLooseBase(this, _registry)[_registry], thisProvider, this._options.rpc);\n    this._isConnected = new BehaviorSubject(this._rpcCore.provider.isConnected);\n    this._rx.hasSubscriptions = this._rpcCore.provider.hasSubscriptions;\n  }\n  /**\n   * @description Return the current used registry\n   */\n\n\n  get registry() {\n    return _classPrivateFieldLooseBase(this, _registry)[_registry];\n  }\n  /**\n   * @description Creates an instance of a type as registered\n   */\n\n\n  createType(type, ...params) {\n    return _classPrivateFieldLooseBase(this, _registry)[_registry].createType(type, ...params);\n  }\n  /**\n   * @description Register additional user-defined of chain-specific types in the type registry\n   */\n\n\n  registerTypes(types) {\n    types && _classPrivateFieldLooseBase(this, _registry)[_registry].register(types);\n  }\n  /**\n   * @returns `true` if the API operates with subscriptions\n   */\n\n\n  get hasSubscriptions() {\n    return this._rpcCore.provider.hasSubscriptions;\n  }\n  /**\n   * @returns `true` if the API decorate multi-key queries\n   */\n\n\n  get supportMulti() {\n    return this._rpcCore.provider.hasSubscriptions || !!this._rpcCore.state.queryStorageAt;\n  }\n\n  _createDecorated(registry, fromEmpty, blockHash, decoratedApi) {\n    if (!decoratedApi) {\n      decoratedApi = {\n        consts: {},\n        errors: {},\n        events: {},\n        query: {}\n      };\n    }\n\n    if (!registry.decoratedMeta) {\n      registry.decoratedMeta = expandMetadata(registry.registry, registry.metadata);\n    } // adjust the versioned registry\n\n\n    augmentObject('consts', registry.decoratedMeta.consts, decoratedApi.consts, fromEmpty);\n    augmentObject('errors', registry.decoratedMeta.errors, decoratedApi.errors, fromEmpty);\n    augmentObject('events', registry.decoratedMeta.events, decoratedApi.events, fromEmpty);\n    const storage = blockHash ? this._decorateStorageAt(registry.decoratedMeta, this._decorateMethod, blockHash) : this._decorateStorage(registry.decoratedMeta, this._decorateMethod);\n    augmentObject('query', storage, decoratedApi.query, fromEmpty);\n    return {\n      decoratedApi,\n      decoratedMeta: registry.decoratedMeta\n    };\n  }\n\n  _injectMetadata(registry, fromEmpty) {\n    // clear the decoration, we are redoing it here\n    if (fromEmpty || !registry.decoratedApi) {\n      registry.decoratedApi = {\n        consts: {},\n        errors: {},\n        events: {},\n        query: {}\n      };\n    }\n\n    const {\n      decoratedApi,\n      decoratedMeta\n    } = this._createDecorated(registry, fromEmpty, null, registry.decoratedApi);\n\n    this._consts = decoratedApi.consts;\n    this._errors = decoratedApi.errors;\n    this._events = decoratedApi.events;\n    this._query = decoratedApi.query;\n\n    if (fromEmpty || !this._extrinsics) {\n      this._extrinsics = this._decorateExtrinsics(decoratedMeta, this._decorateMethod);\n      this._rx.tx = this._decorateExtrinsics(decoratedMeta, this._rxDecorateMethod);\n    } else {\n      augmentObject('tx', this._decorateExtrinsics(decoratedMeta, this._decorateMethod), this._extrinsics, false);\n      augmentObject(null, this._decorateExtrinsics(decoratedMeta, this._rxDecorateMethod), this._rx.tx, false);\n    } // rx\n\n\n    augmentObject(null, this._decorateStorage(decoratedMeta, this._rxDecorateMethod), this._rx.query, fromEmpty);\n    augmentObject(null, decoratedMeta.consts, this._rx.consts, fromEmpty);\n  }\n  /**\n   * @deprecated\n   * backwards compatible endpoint for metadata injection, may be removed in the future (However, it is still useful for testing injection)\n   */\n\n\n  injectMetadata(metadata, fromEmpty, registry) {\n    this._injectMetadata({\n      metadata,\n      registry: registry || _classPrivateFieldLooseBase(this, _registry)[_registry],\n      specName: _classPrivateFieldLooseBase(this, _registry)[_registry].createType('Text'),\n      specVersion: BN_ZERO\n    }, fromEmpty);\n  }\n\n  _decorateFunctionMeta(input, output) {\n    output.meta = input.meta;\n    output.method = input.method;\n    output.section = input.section;\n    output.toJSON = input.toJSON;\n\n    if (input.callIndex) {\n      output.callIndex = input.callIndex;\n    }\n\n    return output;\n  } // Filter all RPC methods based on the results of the rpc_methods call. We do this in the following\n  // manner to cater for both old and new:\n  //   - when the number of entries are 0, only remove the ones with isOptional (account & contracts)\n  //   - when non-zero, remove anything that is not in the array (we don't do this)\n\n\n  _filterRpc(methods, additional) {\n    // add any specific user-base RPCs\n    if (Object.keys(additional).length !== 0) {\n      this._rpcCore.addUserInterfaces(additional); // re-decorate, only adding any new additional interfaces\n\n\n      this._decorateRpc(this._rpcCore, this._decorateMethod, this._rpc);\n\n      this._decorateRpc(this._rpcCore, this._rxDecorateMethod, this._rx.rpc);\n    }\n\n    this._filterRpcMethods(methods);\n  }\n\n  _filterRpcMethods(exposed) {\n    const hasResults = exposed.length !== 0;\n    const allKnown = [...this._rpcCore.mapping.entries()];\n    const allKeys = allKnown.reduce((allKeys, [, {\n      alias,\n      endpoint,\n      method,\n      pubsub,\n      section\n    }]) => {\n      allKeys.push(`${section}_${method}`);\n\n      if (pubsub) {\n        allKeys.push(`${section}_${pubsub[1]}`);\n        allKeys.push(`${section}_${pubsub[2]}`);\n      }\n\n      if (alias) {\n        allKeys.push(...alias);\n      }\n\n      if (endpoint) {\n        allKeys.push(endpoint);\n      }\n\n      return allKeys;\n    }, []);\n    const unknown = exposed.filter(k => !allKeys.includes(k));\n    const deletion = allKnown.filter(([k]) => hasResults && !exposed.includes(k) && k !== 'rpc_methods');\n\n    if (unknown.length) {\n      l.warn(`RPC methods not decorated: ${unknown.join(', ')}`);\n    } // loop through all entries we have (populated in decorate) and filter as required\n    // only remove when we have results and method missing, or with no results if optional\n\n\n    deletion.forEach(([, {\n      method,\n      section\n    }]) => {\n      delete this._rpc[section][method];\n      delete this._rx.rpc[section][method];\n    });\n  }\n\n  _decorateRpc(rpc, decorateMethod, input = {}) {\n    return rpc.sections.reduce((out, _sectionName) => {\n      const sectionName = _sectionName;\n\n      if (!out[sectionName]) {\n        // out and section here are horrors to get right from a typing perspective :(\n        out[sectionName] = Object.entries(rpc[sectionName]).reduce((section, [methodName, method]) => {\n          //  skip subscriptions where we have a non-subscribe interface\n          if (this.hasSubscriptions || !(methodName.startsWith('subscribe') || methodName.startsWith('unsubscribe'))) {\n            section[methodName] = decorateMethod(method, {\n              methodName\n            }); // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\n            section[methodName].json = decorateMethod(method.json, {\n              methodName\n            }); // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\n            section[methodName].raw = decorateMethod(method.raw, {\n              methodName\n            }); // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\n            section[methodName].meta = method.meta;\n          }\n\n          return section;\n        }, {});\n      }\n\n      return out;\n    }, input);\n  } // only be called if supportMulti is true\n\n\n  _decorateMulti(decorateMethod) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return decorateMethod(calls => (this.hasSubscriptions ? this._rpcCore.state.subscribeStorage : this._rpcCore.state.queryStorageAt)(calls.map(arg => Array.isArray(arg) ? [arg[0].creator, ...arg.slice(1)] : [arg.creator])));\n  }\n\n  _decorateExtrinsics({\n    tx\n  }, decorateMethod) {\n    const creator = createSubmittable(this._type, this._rx, decorateMethod);\n    return Object.entries(tx).reduce((out, [name, section]) => {\n      out[name] = Object.entries(section).reduce((out, [name, method]) => {\n        out[name] = this._decorateExtrinsicEntry(method, creator);\n        return out;\n      }, {});\n      return out;\n    }, creator);\n  }\n\n  _decorateExtrinsicEntry(method, creator) {\n    const decorated = (...params) => creator(method(...params)); // pass through the `.is`\n\n\n    decorated.is = other => method.is(other); // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\n\n    return this._decorateFunctionMeta(method, decorated);\n  }\n\n  _decorateStorage({\n    query\n  }, decorateMethod) {\n    return Object.entries(query).reduce((out, [name, section]) => {\n      out[name] = Object.entries(section).reduce((out, [name, method]) => {\n        out[name] = this._decorateStorageEntry(method, decorateMethod);\n        return out;\n      }, {});\n      return out;\n    }, {});\n  }\n\n  _decorateStorageAt({\n    query\n  }, decorateMethod, blockHash) {\n    return Object.entries(query).reduce((out, [name, section]) => {\n      out[name] = Object.entries(section).reduce((out, [name, method]) => {\n        out[name] = this._decorateStorageEntryAt(method, decorateMethod, blockHash);\n        return out;\n      }, {});\n      return out;\n    }, {});\n  }\n\n  _decorateStorageEntry(creator, decorateMethod) {\n    // get the storage arguments, with DoubleMap as an array entry, otherwise spread\n    const getArgs = args => extractStorageArgs(_classPrivateFieldLooseBase(this, _registry)[_registry], creator, args); // Disable this where it occurs for each field we are decorating\n\n    /* eslint-disable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n    const decorated = this._decorateStorageCall(creator, decorateMethod);\n\n    decorated.creator = creator;\n    decorated.at = decorateMethod((hash, ...args) => this._rpcCore.state.getStorage(getArgs(args), hash));\n    decorated.hash = decorateMethod((...args) => this._rpcCore.state.getStorageHash(getArgs(args)));\n\n    decorated.is = key => key.section === creator.section && key.method === creator.method;\n\n    decorated.key = (...args) => u8aToHex(compactStripLength(creator(creator.meta.type.isPlain ? undefined : creator.meta.type.isMap ? args[0] : creator.meta.type.isDoubleMap ? [args[0], args[1]] : args))[1]);\n\n    decorated.keyPrefix = (...keys) => u8aToHex(creator.keyPrefix(...keys));\n\n    decorated.range = decorateMethod((range, ...args) => this._decorateStorageRange(decorated, args, range));\n    decorated.size = decorateMethod((...args) => this._rpcCore.state.getStorageSize(getArgs(args)));\n    decorated.sizeAt = decorateMethod((hash, ...args) => this._rpcCore.state.getStorageSize(getArgs(args), hash)); // FIXME NMap support\n    // .keys() & .entries() only available on map types\n\n    if (creator.iterKey && (creator.meta.type.isMap || creator.meta.type.isDoubleMap || creator.meta.type.isNMap)) {\n      decorated.entries = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], (...args) => this._retrieveMapEntries(creator, null, args)));\n      decorated.entriesAt = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], (hash, ...args) => this._retrieveMapEntries(creator, hash, args)));\n      decorated.entriesPaged = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], opts => this._retrieveMapEntriesPaged(creator, opts)));\n      decorated.keys = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], (...args) => this._retrieveMapKeys(creator, null, args)));\n      decorated.keysAt = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], (hash, ...args) => this._retrieveMapKeys(creator, hash, args)));\n      decorated.keysPaged = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], opts => this._retrieveMapKeysPaged(creator, opts)));\n    }\n\n    if (this.supportMulti) {\n      // When using double map storage function, user need to pass double map key as an array\n      decorated.multi = decorateMethod(args => this._retrieveMulti(args.map(arg => [creator, arg])));\n    }\n    /* eslint-enable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n    return this._decorateFunctionMeta(creator, decorated);\n  }\n\n  _decorateStorageEntryAt(creator, decorateMethod, blockHash) {\n    // get the storage arguments, with DoubleMap as an array entry, otherwise spread\n    const getArgs = args => extractStorageArgs(_classPrivateFieldLooseBase(this, _registry)[_registry], creator, args); // Disable this where it occurs for each field we are decorating\n\n    /* eslint-disable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n    const decorated = decorateMethod((...args) => this._rpcCore.state.getStorage(getArgs(args), blockHash));\n    decorated.creator = creator;\n    decorated.hash = decorateMethod((...args) => this._rpcCore.state.getStorageHash(getArgs(args), blockHash));\n\n    decorated.is = key => key.section === creator.section && key.method === creator.method;\n\n    decorated.key = (...args) => u8aToHex(compactStripLength(creator(creator.meta.type.isPlain ? undefined : creator.meta.type.isMap ? args[0] : creator.meta.type.isDoubleMap ? [args[0], args[1]] : args))[1]);\n\n    decorated.keyPrefix = (...keys) => u8aToHex(creator.keyPrefix(...keys));\n\n    decorated.size = decorateMethod((...args) => this._rpcCore.state.getStorageSize(getArgs(args), blockHash)); // FIXME NMap support\n    // .keys() & .entries() only available on map types\n\n    if (creator.iterKey && (creator.meta.type.isMap || creator.meta.type.isDoubleMap)) {\n      decorated.entries = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], (...args) => this._retrieveMapEntries(creator, blockHash, args)));\n      decorated.keys = decorateMethod(memo(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], (...args) => this._retrieveMapKeys(creator, blockHash, args)));\n    }\n    /* eslint-enable @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment */\n\n\n    return this._decorateFunctionMeta(creator, decorated);\n  } // Decorate the base storage call. In the case or rxjs or promise-without-callback (await)\n  // we make a subscription, alternatively we push this through a single-shot query\n\n\n  _decorateStorageCall(creator, decorateMethod) {\n    return decorateMethod((...args) => {\n      return this.hasSubscriptions ? this._rpcCore.state.subscribeStorage([extractStorageArgs(_classPrivateFieldLooseBase(this, _registry)[_registry], creator, args)]).pipe(map(([data]) => data) // extract first/only result from list\n      ) : this._rpcCore.state.getStorage(extractStorageArgs(_classPrivateFieldLooseBase(this, _registry)[_registry], creator, args));\n    }, {\n      methodName: creator.method,\n      overrideNoSub: (...args) => this._rpcCore.state.getStorage(extractStorageArgs(_classPrivateFieldLooseBase(this, _registry)[_registry], creator, args))\n    });\n  }\n\n  _decorateStorageRange(decorated, args, range) {\n    const outputType = unwrapStorageType(_classPrivateFieldLooseBase(this, _registry)[_registry], decorated.creator.meta.type, decorated.creator.meta.modifier.isOptional);\n    return this._rpcCore.state.queryStorage([decorated.key(...args)], ...range).pipe(map(result => result.map(([blockHash, [value]]) => [blockHash, this.createType(outputType, value.isSome ? value.unwrap().toHex() : undefined)])));\n  } // retrieve a set of values for a specific set of keys - here we chunk the keys into PAGE_SIZE sizes\n\n\n  _retrieveMulti(keys) {\n    if (!keys.length) {\n      return of([]);\n    }\n\n    const queryCall = this.hasSubscriptions ? this._rpcCore.state.subscribeStorage : this._rpcCore.state.queryStorageAt;\n    return combineLatest(arrayChunk(keys, PAGE_SIZE_V).map(keys => queryCall(keys))).pipe(map(arrayFlatten));\n  }\n\n  _retrieveMapKeys({\n    iterKey,\n    meta,\n    method,\n    section\n  }, at, args) {\n    assert(iterKey && (meta.type.isMap || meta.type.isDoubleMap || meta.type.isNMap), 'keys can only be retrieved on maps, linked maps and double maps');\n    const headKey = iterKey(...args).toHex();\n    const startSubject = new BehaviorSubject(headKey);\n    const queryCall = at ? startKey => this._rpcCore.state.getKeysPaged(headKey, PAGE_SIZE_K, startKey, at) : startKey => this._rpcCore.state.getKeysPaged(headKey, PAGE_SIZE_K, startKey);\n    return startSubject.pipe(switchMap(queryCall), map(keys => keys.map(key => key.setMeta(meta, section, method))), tap(keys => {\n      setTimeout(() => {\n        keys.length === PAGE_SIZE_K ? startSubject.next(keys[PAGE_SIZE_K - 1].toHex()) : startSubject.complete();\n      }, 0);\n    }), toArray(), // toArray since we want to startSubject to be completed\n    map(arrayFlatten));\n  }\n\n  _retrieveMapKeysPaged({\n    iterKey,\n    meta,\n    method,\n    section\n  }, opts) {\n    assert(iterKey && (meta.type.isMap || meta.type.isDoubleMap || meta.type.isNMap), 'keys can only be retrieved on maps, linked maps and double maps');\n    const headKey = iterKey(...opts.args).toHex();\n    return this._rpcCore.state.getKeysPaged(headKey, opts.pageSize, opts.startKey || headKey).pipe(map(keys => keys.map(key => key.setMeta(meta, section, method))));\n  }\n\n  _retrieveMapEntries(entry, at, args) {\n    const query = at ? keyset => this._rpcCore.state.queryStorageAt(keyset, at) : keyset => this._rpcCore.state.queryStorageAt(keyset);\n    return this._retrieveMapKeys(entry, at, args).pipe(switchMap(keys => keys.length ? combineLatest(arrayChunk(keys, PAGE_SIZE_V).map(query)).pipe(map(valsArr => arrayFlatten(valsArr).map((value, index) => [keys[index], value]))) : of([])));\n  }\n\n  _retrieveMapEntriesPaged(entry, opts) {\n    return this._retrieveMapKeysPaged(entry, opts).pipe(switchMap(keys => keys.length ? this._rpcCore.state.queryStorageAt(keys).pipe(map(valsArr => valsArr.map((value, index) => [keys[index], value]))) : of([])));\n  }\n\n  _decorateDeriveRx(decorateMethod) {\n    var _this$_runtimeVersion, _this$_options$typesB, _this$_options$typesB2, _this$_options$typesB3;\n\n    const specName = (_this$_runtimeVersion = this._runtimeVersion) === null || _this$_runtimeVersion === void 0 ? void 0 : _this$_runtimeVersion.specName.toString();\n\n    const derives = _objectSpread(_objectSpread({}, this._options.derives), ((_this$_options$typesB = this._options.typesBundle) === null || _this$_options$typesB === void 0 ? void 0 : (_this$_options$typesB2 = _this$_options$typesB.spec) === null || _this$_options$typesB2 === void 0 ? void 0 : (_this$_options$typesB3 = _this$_options$typesB2[specName !== null && specName !== void 0 ? specName : '']) === null || _this$_options$typesB3 === void 0 ? void 0 : _this$_options$typesB3.derives) || {}); // Pull in derive from api-derive\n\n\n    const derive = decorateDerive(_classPrivateFieldLooseBase(this, _instanceId)[_instanceId], this._rx, derives);\n    return decorateSections(derive, decorateMethod);\n  }\n\n  _decorateDerive(decorateMethod) {\n    return decorateSections(this._rx.derive, decorateMethod);\n  }\n  /**\n   * Put the `this.onCall` function of ApiRx here, because it is needed by\n   * `api._rx`.\n   */\n\n\n}"]},"metadata":{},"sourceType":"module"}