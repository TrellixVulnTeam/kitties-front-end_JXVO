{"ast":null,"code":"import _objectSpread from\"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Button}from'semantic-ui-react';import{web3FromSource}from'@polkadot/extension-dapp';import{useSubstrate}from'../';import utils from'../utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function TxButton(_ref){var _ref$accountPair=_ref.accountPair,accountPair=_ref$accountPair===void 0?null:_ref$accountPair,label=_ref.label,setStatus=_ref.setStatus,_ref$color=_ref.color,color=_ref$color===void 0?'blue':_ref$color,_ref$style=_ref.style,style=_ref$style===void 0?null:_ref$style,_ref$type=_ref.type,type=_ref$type===void 0?'QUERY':_ref$type,_ref$attrs=_ref.attrs,attrs=_ref$attrs===void 0?null:_ref$attrs,_ref$onClick=_ref.onClick,onClick=_ref$onClick===void 0?null:_ref$onClick,_ref$disabled=_ref.disabled,disabled=_ref$disabled===void 0?false:_ref$disabled;// Hooks\nvar _useSubstrate=useSubstrate(),api=_useSubstrate.api;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),unsub=_useState2[0],setUnsub=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),sudoKey=_useState4[0],setSudoKey=_useState4[1];var palletRpc=attrs.palletRpc,callable=attrs.callable,inputParams=attrs.inputParams,paramFields=attrs.paramFields;var isQuery=function isQuery(){return type==='QUERY';};var isSudo=function isSudo(){return type==='SUDO-TX';};var isUncheckedSudo=function isUncheckedSudo(){return type==='UNCHECKED-SUDO-TX';};var isUnsigned=function isUnsigned(){return type==='UNSIGNED-TX';};var isSigned=function isSigned(){return type==='SIGNED-TX';};var isRpc=function isRpc(){return type==='RPC';};var isConstant=function isConstant(){return type==='CONSTANT';};var loadSudoKey=function loadSudoKey(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var sudoKey;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!api||!api.query.sudo)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.next=4;return api.query.sudo.key();case 4:sudoKey=_context.sent;sudoKey.isEmpty?setSudoKey(null):setSudoKey(sudoKey.toString());case 6:case\"end\":return _context.stop();}}},_callee);}))();};useEffect(loadSudoKey,[api]);var getFromAcct=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var address,_accountPair$meta,source,isInjected,fromAcct,injected;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:address=accountPair.address,_accountPair$meta=accountPair.meta,source=_accountPair$meta.source,isInjected=_accountPair$meta.isInjected;if(!isInjected){_context2.next=9;break;}_context2.next=4;return web3FromSource(source);case 4:injected=_context2.sent;fromAcct=address;api.setSigner(injected.signer);_context2.next=10;break;case 9:fromAcct=accountPair;case 10:return _context2.abrupt(\"return\",fromAcct);case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function getFromAcct(){return _ref3.apply(this,arguments);};}();var txResHandler=function txResHandler(_ref4){var status=_ref4.status;return status.isFinalized?setStatus(\"\\uD83D\\uDE09 Finalized. Block hash: \".concat(status.asFinalized.toString())):setStatus(\"Current transaction status: \".concat(status.type));};var txErrHandler=function txErrHandler(err){return setStatus(\"\\uD83D\\uDE1E Transaction Failed: \".concat(err.toString()));};var sudoTx=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _api$tx$palletRpc;var fromAcct,transformed,txExecute,unsub;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getFromAcct();case 2:fromAcct=_context3.sent;transformed=transformParams(paramFields,inputParams);txExecute=transformed?api.tx.sudo.sudo((_api$tx$palletRpc=api.tx[palletRpc])[callable].apply(_api$tx$palletRpc,_toConsumableArray(transformed))):api.tx.sudo.sudo(api.tx[palletRpc][callable]());unsub=txExecute.signAndSend(fromAcct,txResHandler).catch(txErrHandler);// note: you cannot store a function directly in React state hook. You need to wrap it in\n//   anonymous function. See: https://bit.ly/30hbINF\nsetUnsub(function(){return unsub;});case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function sudoTx(){return _ref5.apply(this,arguments);};}();var uncheckedSudoTx=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _api$tx$palletRpc2;var fromAcct,txExecute,unsub;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return getFromAcct();case 2:fromAcct=_context4.sent;txExecute=api.tx.sudo.sudoUncheckedWeight((_api$tx$palletRpc2=api.tx[palletRpc])[callable].apply(_api$tx$palletRpc2,_toConsumableArray(inputParams)),0);unsub=txExecute.signAndSend(fromAcct,txResHandler).catch(txErrHandler);setUnsub(function(){return unsub;});case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function uncheckedSudoTx(){return _ref6.apply(this,arguments);};}();var signedTx=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var _api$tx$palletRpc3;var fromAcct,transformed,txExecute,unsub;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return getFromAcct();case 2:fromAcct=_context5.sent;transformed=transformParams(paramFields,inputParams);txExecute=transformed?(_api$tx$palletRpc3=api.tx[palletRpc])[callable].apply(_api$tx$palletRpc3,_toConsumableArray(transformed)):api.tx[palletRpc][callable]();_context5.next=7;return txExecute.signAndSend(fromAcct,txResHandler).catch(txErrHandler);case 7:unsub=_context5.sent;setUnsub(function(){return unsub;});case 9:case\"end\":return _context5.stop();}}},_callee5);}));return function signedTx(){return _ref7.apply(this,arguments);};}();var unsignedTx=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _api$tx$palletRpc4;var transformed,txExecute,unsub;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:transformed=transformParams(paramFields,inputParams);txExecute=transformed?(_api$tx$palletRpc4=api.tx[palletRpc])[callable].apply(_api$tx$palletRpc4,_toConsumableArray(transformed)):api.tx[palletRpc][callable]();_context6.next=4;return txExecute.send(txResHandler).catch(txErrHandler);case 4:unsub=_context6.sent;setUnsub(function(){return unsub;});case 6:case\"end\":return _context6.stop();}}},_callee6);}));return function unsignedTx(){return _ref8.apply(this,arguments);};}();var queryResHandler=function queryResHandler(result){return result.isNone?setStatus('None'):setStatus(result.toString());};var query=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var _api$query$palletRpc;var transformed,unsub;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:transformed=transformParams(paramFields,inputParams);_context7.next=3;return(_api$query$palletRpc=api.query[palletRpc])[callable].apply(_api$query$palletRpc,_toConsumableArray(transformed).concat([queryResHandler]));case 3:unsub=_context7.sent;setUnsub(function(){return unsub;});case 5:case\"end\":return _context7.stop();}}},_callee7);}));return function query(){return _ref9.apply(this,arguments);};}();var rpc=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var _api$rpc$palletRpc;var transformed,unsub;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:transformed=transformParams(paramFields,inputParams,{emptyAsNull:false});_context8.next=3;return(_api$rpc$palletRpc=api.rpc[palletRpc])[callable].apply(_api$rpc$palletRpc,_toConsumableArray(transformed).concat([queryResHandler]));case 3:unsub=_context8.sent;setUnsub(function(){return unsub;});case 5:case\"end\":return _context8.stop();}}},_callee8);}));return function rpc(){return _ref10.apply(this,arguments);};}();var constant=function constant(){var result=api.consts[palletRpc][callable];result.isNone?setStatus('None'):setStatus(result.toString());};var transaction=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(unsub){unsub();setUnsub(null);}setStatus('Sending...');isSudo()&&sudoTx()||isUncheckedSudo()&&uncheckedSudoTx()||isSigned()&&signedTx()||isUnsigned()&&unsignedTx()||isQuery()&&query()||isRpc()&&rpc()||isConstant()&&constant();case 3:case\"end\":return _context9.stop();}}},_callee9);}));return function transaction(){return _ref11.apply(this,arguments);};}();// notes: If onClick handler is passed in, we want to call it. But we want call the handler\n//   only when the unsubscription handler (unsub) is ready, so we can pass the unsub handler to\n//   the onClick handler for processing. Thus we use a `useEffect` here.\nuseEffect(function(){if(unsub&&onClick){onClick(unsub);setUnsub(null);}},[unsub,onClick]);var transformParams=function transformParams(paramFields,inputParams){var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{emptyAsNull:true};// if `opts.emptyAsNull` is true, empty param value will be added to res as `null`.\n//   Otherwise, it will not be added\nvar paramVal=inputParams.map(function(inputParam){// To cater the js quirk that `null` is a type of `object`.\nif(typeof inputParam==='object'&&inputParam!==null&&typeof inputParam.value==='string'){return inputParam.value.trim();}else if(typeof inputParam==='string'){return inputParam.trim();}return inputParam;});var params=paramFields.map(function(field,ind){return _objectSpread(_objectSpread({},field),{},{value:typeof paramVal[ind]==='undefined'?null:paramVal[ind]});});return params.reduce(function(memo,_ref12){var _ref12$type=_ref12.type,type=_ref12$type===void 0?'string':_ref12$type,value=_ref12.value;if(value==null||value==='')return opts.emptyAsNull?[].concat(_toConsumableArray(memo),[null]):memo;var converted=value;// Deal with a vector\nif(type.indexOf('Vec<')>=0){converted=converted.split(',').map(function(e){return e.trim();});converted=converted.map(function(single){return isNumType(type)?single.indexOf('.')>=0?Number.parseFloat(single):Number.parseInt(single):single;});return[].concat(_toConsumableArray(memo),[converted]);}// Deal with a single value\nif(isNumType(type)){converted=converted.indexOf('.')>=0?Number.parseFloat(converted):Number.parseInt(converted);}return[].concat(_toConsumableArray(memo),[converted]);},[]);};var isNumType=function isNumType(type){return utils.paramConversion.num.some(function(el){return type.indexOf(el)>=0;});};var allParamsFilled=function allParamsFilled(){if(paramFields.length===0){return true;}return paramFields.every(function(paramField,ind){var param=inputParams[ind];if(paramField.optional){return true;}if(param==null){return false;}var value=typeof param==='object'?param.value:param;return value!==null&&value!=='';});};var isSudoer=function isSudoer(acctPair){if(!sudoKey||!acctPair){return false;}return acctPair.address===sudoKey;};return/*#__PURE__*/_jsx(Button,{basic:true,color:color,style:style,type:\"submit\",onClick:transaction,disabled:disabled||!palletRpc||!callable||!allParamsFilled()||(isSudo()||isUncheckedSudo())&&!isSudoer(accountPair),children:label});}// prop type checking\nfunction TxGroupButton(props){return/*#__PURE__*/_jsxs(Button.Group,{children:[/*#__PURE__*/_jsx(TxButton,_objectSpread({label:\"Unsigned\",type:\"UNSIGNED-TX\",color:\"grey\"},props)),/*#__PURE__*/_jsx(Button.Or,{}),/*#__PURE__*/_jsx(TxButton,_objectSpread({label:\"Signed\",type:\"SIGNED-TX\",color:\"blue\"},props)),/*#__PURE__*/_jsx(Button.Or,{}),/*#__PURE__*/_jsx(TxButton,_objectSpread({label:\"SUDO\",type:\"SUDO-TX\",color:\"red\"},props))]});}export{TxButton,TxGroupButton};","map":{"version":3,"sources":["/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/src/substrate-lib/components/TxButton.js"],"names":["React","useState","useEffect","Button","web3FromSource","useSubstrate","utils","TxButton","accountPair","label","setStatus","color","style","type","attrs","onClick","disabled","api","unsub","setUnsub","sudoKey","setSudoKey","palletRpc","callable","inputParams","paramFields","isQuery","isSudo","isUncheckedSudo","isUnsigned","isSigned","isRpc","isConstant","loadSudoKey","query","sudo","key","isEmpty","toString","getFromAcct","address","meta","source","isInjected","injected","fromAcct","setSigner","signer","txResHandler","status","isFinalized","asFinalized","txErrHandler","err","sudoTx","transformed","transformParams","txExecute","tx","signAndSend","catch","uncheckedSudoTx","sudoUncheckedWeight","signedTx","unsignedTx","send","queryResHandler","result","isNone","rpc","emptyAsNull","constant","consts","transaction","opts","paramVal","map","inputParam","value","trim","params","field","ind","reduce","memo","converted","indexOf","split","e","single","isNumType","Number","parseFloat","parseInt","paramConversion","num","some","el","allParamsFilled","length","every","paramField","param","optional","isSudoer","acctPair","TxGroupButton","props"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Button } from 'semantic-ui-react'\nimport { web3FromSource } from '@polkadot/extension-dapp'\n\nimport { useSubstrate } from '../'\nimport utils from '../utils'\n\nfunction TxButton ({\n  accountPair = null,\n  label,\n  setStatus,\n  color = 'blue',\n  style = null,\n  type = 'QUERY',\n  attrs = null,\n  onClick = null,\n  disabled = false\n}) {\n  // Hooks\n  const { api } = useSubstrate()\n  const [unsub, setUnsub] = useState(null)\n  const [sudoKey, setSudoKey] = useState(null)\n\n  const { palletRpc, callable, inputParams, paramFields } = attrs\n\n  const isQuery = () => type === 'QUERY'\n  const isSudo = () => type === 'SUDO-TX'\n  const isUncheckedSudo = () => type === 'UNCHECKED-SUDO-TX'\n  const isUnsigned = () => type === 'UNSIGNED-TX'\n  const isSigned = () => type === 'SIGNED-TX'\n  const isRpc = () => type === 'RPC'\n  const isConstant = () => type === 'CONSTANT'\n\n  const loadSudoKey = () => {\n    (async function () {\n      if (!api || !api.query.sudo) { return }\n      const sudoKey = await api.query.sudo.key()\n      sudoKey.isEmpty ? setSudoKey(null) : setSudoKey(sudoKey.toString())\n    })()\n  }\n\n  useEffect(loadSudoKey, [api])\n\n  const getFromAcct = async () => {\n    const {\n      address,\n      meta: { source, isInjected }\n    } = accountPair\n    let fromAcct\n\n    // signer is from Polkadot-js browser extension\n    if (isInjected) {\n      const injected = await web3FromSource(source)\n      fromAcct = address\n      api.setSigner(injected.signer)\n    } else {\n      fromAcct = accountPair\n    }\n\n    return fromAcct\n  }\n\n  const txResHandler = ({ status }) =>\n    status.isFinalized\n      ? setStatus(`😉 Finalized. Block hash: ${status.asFinalized.toString()}`)\n      : setStatus(`Current transaction status: ${status.type}`)\n\n  const txErrHandler = err =>\n    setStatus(`😞 Transaction Failed: ${err.toString()}`)\n\n  const sudoTx = async () => {\n    const fromAcct = await getFromAcct()\n    const transformed = transformParams(paramFields, inputParams)\n    const txExecute = transformed\n      ? api.tx.sudo.sudo(api.tx[palletRpc][callable](...transformed))\n      : api.tx.sudo.sudo(api.tx[palletRpc][callable]())\n\n    const unsub = txExecute.signAndSend(fromAcct, txResHandler)\n      .catch(txErrHandler)\n    // note: you cannot store a function directly in React state hook. You need to wrap it in\n    //   anonymous function. See: https://bit.ly/30hbINF\n    setUnsub(() => unsub)\n  }\n\n  const uncheckedSudoTx = async () => {\n    const fromAcct = await getFromAcct()\n    const txExecute =\n      api.tx.sudo.sudoUncheckedWeight(api.tx[palletRpc][callable](...inputParams), 0)\n\n    const unsub = txExecute.signAndSend(fromAcct, txResHandler)\n      .catch(txErrHandler)\n    setUnsub(() => unsub)\n  }\n\n  const signedTx = async () => {\n    const fromAcct = await getFromAcct()\n    const transformed = transformParams(paramFields, inputParams)\n\n    const txExecute = transformed\n      ? api.tx[palletRpc][callable](...transformed)\n      : api.tx[palletRpc][callable]()\n\n    const unsub = await txExecute.signAndSend(fromAcct, txResHandler)\n      .catch(txErrHandler)\n    setUnsub(() => unsub)\n  }\n\n  const unsignedTx = async () => {\n    const transformed = transformParams(paramFields, inputParams)\n    const txExecute = transformed\n      ? api.tx[palletRpc][callable](...transformed)\n      : api.tx[palletRpc][callable]()\n\n    const unsub = await txExecute.send(txResHandler)\n      .catch(txErrHandler)\n    setUnsub(() => unsub)\n  }\n\n  const queryResHandler = result =>\n    result.isNone ? setStatus('None') : setStatus(result.toString())\n\n  const query = async () => {\n    const transformed = transformParams(paramFields, inputParams)\n    const unsub = await api.query[palletRpc][callable](...transformed, queryResHandler)\n    setUnsub(() => unsub)\n  }\n\n  const rpc = async () => {\n    const transformed = transformParams(paramFields, inputParams, { emptyAsNull: false })\n    const unsub = await api.rpc[palletRpc][callable](...transformed, queryResHandler)\n    setUnsub(() => unsub)\n  }\n\n  const constant = () => {\n    const result = api.consts[palletRpc][callable]\n    result.isNone ? setStatus('None') : setStatus(result.toString())\n  }\n\n  const transaction = async () => {\n    if (unsub) {\n      unsub()\n      setUnsub(null)\n    }\n\n    setStatus('Sending...');\n\n    (isSudo() && sudoTx()) ||\n    (isUncheckedSudo() && uncheckedSudoTx()) ||\n    (isSigned() && signedTx()) ||\n    (isUnsigned() && unsignedTx()) ||\n    (isQuery() && query()) ||\n    (isRpc() && rpc()) ||\n    (isConstant() && constant())\n  }\n\n  // notes: If onClick handler is passed in, we want to call it. But we want call the handler\n  //   only when the unsubscription handler (unsub) is ready, so we can pass the unsub handler to\n  //   the onClick handler for processing. Thus we use a `useEffect` here.\n  useEffect(() => {\n    if (unsub && onClick) {\n      onClick(unsub)\n      setUnsub(null)\n    }\n  }, [unsub, onClick])\n\n  const transformParams = (paramFields, inputParams, opts = { emptyAsNull: true }) => {\n    // if `opts.emptyAsNull` is true, empty param value will be added to res as `null`.\n    //   Otherwise, it will not be added\n    const paramVal = inputParams.map(inputParam => {\n      // To cater the js quirk that `null` is a type of `object`.\n      if (typeof inputParam === 'object' && inputParam !== null && typeof inputParam.value === 'string') {\n        return inputParam.value.trim()\n      } else if (typeof inputParam === 'string') {\n        return inputParam.trim()\n      }\n      return inputParam\n    })\n    const params = paramFields.map((field, ind) =>\n      ({ ...field, value: typeof paramVal[ind] === 'undefined' ? null : paramVal[ind] }))\n\n    return params.reduce((memo, { type = 'string', value }) => {\n      if (value == null || value === '') return (opts.emptyAsNull ? [...memo, null] : memo)\n\n      let converted = value\n\n      // Deal with a vector\n      if (type.indexOf('Vec<') >= 0) {\n        converted = converted.split(',').map(e => e.trim())\n        converted = converted.map(single => isNumType(type)\n          ? (single.indexOf('.') >= 0 ? Number.parseFloat(single) : Number.parseInt(single))\n          : single\n        )\n        return [...memo, converted]\n      }\n\n      // Deal with a single value\n      if (isNumType(type)) {\n        converted = converted.indexOf('.') >= 0 ? Number.parseFloat(converted) : Number.parseInt(converted)\n      }\n      return [...memo, converted]\n    }, [])\n  }\n\n  const isNumType = type =>\n    utils.paramConversion.num.some(el => type.indexOf(el) >= 0)\n\n  const allParamsFilled = () => {\n    if (paramFields.length === 0) { return true }\n\n    return paramFields.every((paramField, ind) => {\n      const param = inputParams[ind]\n      if (paramField.optional) { return true }\n      if (param == null) { return false }\n\n      const value = typeof param === 'object' ? param.value : param\n      return value !== null && value !== ''\n    })\n  }\n\n  const isSudoer = acctPair => {\n    if (!sudoKey || !acctPair) { return false }\n    return acctPair.address === sudoKey\n  }\n\n  return (\n    <Button\n      basic\n      color={color}\n      style={style}\n      type='submit'\n      onClick={transaction}\n      disabled={ disabled || !palletRpc || !callable || !allParamsFilled() ||\n        ((isSudo() || isUncheckedSudo()) && !isSudoer(accountPair)) }\n    >\n      {label}\n    </Button>\n  )\n}\n\n// prop type checking\nTxButton.propTypes = {\n  accountPair: PropTypes.object,\n  setStatus: PropTypes.func.isRequired,\n  onClick: PropTypes.func,\n  type: PropTypes.oneOf([\n    'QUERY', 'RPC', 'SIGNED-TX', 'UNSIGNED-TX', 'SUDO-TX', 'UNCHECKED-SUDO-TX',\n    'CONSTANT']).isRequired,\n  attrs: PropTypes.shape({\n    palletRpc: PropTypes.string,\n    callable: PropTypes.string,\n    inputParams: PropTypes.array,\n    paramFields: PropTypes.array\n  }).isRequired\n}\n\nfunction TxGroupButton (props) {\n  return (\n    <Button.Group>\n      <TxButton\n        label='Unsigned'\n        type='UNSIGNED-TX'\n        color='grey'\n        {...props}\n      />\n      <Button.Or />\n      <TxButton\n        label='Signed'\n        type='SIGNED-TX'\n        color='blue'\n        {...props}\n      />\n      <Button.Or />\n      <TxButton\n        label='SUDO'\n        type='SUDO-TX'\n        color='red'\n        {...props}\n      />\n    </Button.Group>\n  )\n}\n\nexport { TxButton, TxGroupButton }\n"]},"metadata":{},"sourceType":"module"}