{"ast":null,"code":"import _slicedToArray from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { deriveCache, memo } from \"../util/index.js\";\nvar CACHE_KEY = 'eraSlashes';\n\nfunction mapSlashes(era, noms, vals) {\n  var nominators = {};\n  var validators = {};\n  noms.forEach(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        key = _ref2[0],\n        optBalance = _ref2[1];\n\n    nominators[key.args[1].toString()] = optBalance.unwrap();\n  });\n  vals.forEach(function (_ref3) {\n    var _ref4 = _slicedToArray(_ref3, 2),\n        key = _ref4[0],\n        optRes = _ref4[1];\n\n    validators[key.args[1].toString()] = optRes.unwrapOrDefault()[1];\n  });\n  return {\n    era: era,\n    nominators: nominators,\n    validators: validators\n  };\n}\n\nexport function _eraSlashes(instanceId, api) {\n  return memo(instanceId, function (era, withActive) {\n    var cacheKey = \"\".concat(CACHE_KEY, \"-\").concat(era.toString());\n    var cached = withActive ? undefined : deriveCache.get(cacheKey);\n    return cached ? of(cached) : combineLatest([api.query.staking.nominatorSlashInEra.entries(era), api.query.staking.validatorSlashInEra.entries(era)]).pipe(map(function (_ref5) {\n      var _ref6 = _slicedToArray(_ref5, 2),\n          noms = _ref6[0],\n          vals = _ref6[1];\n\n      var value = mapSlashes(era, noms, vals);\n      !withActive && deriveCache.set(cacheKey, value);\n      return value;\n    }));\n  });\n}\nexport function eraSlashes(instanceId, api) {\n  return memo(instanceId, function (era) {\n    return api.derive.staking._eraSlashes(era, true);\n  });\n}\nexport function _erasSlashes(instanceId, api) {\n  return memo(instanceId, function (eras, withActive) {\n    return eras.length ? combineLatest(eras.map(function (era) {\n      return api.derive.staking._eraSlashes(era, withActive);\n    })) : of([]);\n  });\n}\nexport function erasSlashes(instanceId, api) {\n  return memo(instanceId, function () {\n    var withActive = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return api.derive.staking.erasHistoric(withActive).pipe(switchMap(function (eras) {\n      return api.derive.staking._erasSlashes(eras, withActive);\n    }));\n  });\n}","map":{"version":3,"sources":["/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/@polkadot/api-derive/staking/erasSlashes.js"],"names":["combineLatest","map","of","switchMap","deriveCache","memo","CACHE_KEY","mapSlashes","era","noms","vals","nominators","validators","forEach","key","optBalance","args","toString","unwrap","optRes","unwrapOrDefault","_eraSlashes","instanceId","api","withActive","cacheKey","cached","undefined","get","query","staking","nominatorSlashInEra","entries","validatorSlashInEra","pipe","value","set","eraSlashes","derive","_erasSlashes","eras","length","erasSlashes","erasHistoric"],"mappings":"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","sourcesContent":["// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { deriveCache, memo } from \"../util/index.js\";\nconst CACHE_KEY = 'eraSlashes';\n\nfunction mapSlashes(era, noms, vals) {\n  const nominators = {};\n  const validators = {};\n  noms.forEach(([key, optBalance]) => {\n    nominators[key.args[1].toString()] = optBalance.unwrap();\n  });\n  vals.forEach(([key, optRes]) => {\n    validators[key.args[1].toString()] = optRes.unwrapOrDefault()[1];\n  });\n  return {\n    era,\n    nominators,\n    validators\n  };\n}\n\nexport function _eraSlashes(instanceId, api) {\n  return memo(instanceId, (era, withActive) => {\n    const cacheKey = `${CACHE_KEY}-${era.toString()}`;\n    const cached = withActive ? undefined : deriveCache.get(cacheKey);\n    return cached ? of(cached) : combineLatest([api.query.staking.nominatorSlashInEra.entries(era), api.query.staking.validatorSlashInEra.entries(era)]).pipe(map(([noms, vals]) => {\n      const value = mapSlashes(era, noms, vals);\n      !withActive && deriveCache.set(cacheKey, value);\n      return value;\n    }));\n  });\n}\nexport function eraSlashes(instanceId, api) {\n  return memo(instanceId, era => api.derive.staking._eraSlashes(era, true));\n}\nexport function _erasSlashes(instanceId, api) {\n  return memo(instanceId, (eras, withActive) => eras.length ? combineLatest(eras.map(era => api.derive.staking._eraSlashes(era, withActive))) : of([]));\n}\nexport function erasSlashes(instanceId, api) {\n  return memo(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe(switchMap(eras => api.derive.staking._erasSlashes(eras, withActive))));\n}"]},"metadata":{},"sourceType":"module"}