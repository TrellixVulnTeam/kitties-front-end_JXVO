{"ast":null,"code":"import _slicedToArray from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of } from 'rxjs';\nimport { memo } from \"../util/index.js\"; // Voter is current tuple is 2.x-era\n\nfunction isVoter(value) {\n  return !Array.isArray(value);\n}\n\nfunction retrieveStakeOf(elections) {\n  return elections.stakeOf.entries().pipe(map(function (entries) {\n    return entries.map(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n          _ref2$0$args = _slicedToArray(_ref2[0].args, 1),\n          accountId = _ref2$0$args[0],\n          stake = _ref2[1];\n\n      return [accountId, stake];\n    });\n  }));\n}\n\nfunction retrieveVoteOf(elections) {\n  return elections.votesOf.entries().pipe(map(function (entries) {\n    return entries.map(function (_ref3) {\n      var _ref4 = _slicedToArray(_ref3, 2),\n          _ref4$0$args = _slicedToArray(_ref4[0].args, 1),\n          accountId = _ref4$0$args[0],\n          votes = _ref4[1];\n\n      return [accountId, votes];\n    });\n  }));\n}\n\nfunction retrievePrev(api, elections) {\n  return combineLatest([retrieveStakeOf(elections), retrieveVoteOf(elections)]).pipe(map(function (_ref5) {\n    var _ref6 = _slicedToArray(_ref5, 2),\n        stakes = _ref6[0],\n        votes = _ref6[1];\n\n    var result = [];\n    votes.forEach(function (_ref7) {\n      var _ref8 = _slicedToArray(_ref7, 2),\n          voter = _ref8[0],\n          votes = _ref8[1];\n\n      result.push([voter, {\n        stake: api.registry.createType('Balance'),\n        votes: votes\n      }]);\n    });\n    stakes.forEach(function (_ref9) {\n      var _ref10 = _slicedToArray(_ref9, 2),\n          staker = _ref10[0],\n          stake = _ref10[1];\n\n      var entry = result.find(function (_ref11) {\n        var _ref12 = _slicedToArray(_ref11, 1),\n            voter = _ref12[0];\n\n        return voter.eq(staker);\n      });\n\n      if (entry) {\n        entry[1].stake = stake;\n      } else {\n        result.push([staker, {\n          stake: stake,\n          votes: []\n        }]);\n      }\n    });\n    return result;\n  }));\n}\n\nfunction retrieveCurrent(elections) {\n  return elections.voting.entries().pipe(map(function (entries) {\n    return entries.map(function (_ref13) {\n      var _ref14 = _slicedToArray(_ref13, 2),\n          _ref14$0$args = _slicedToArray(_ref14[0].args, 1),\n          accountId = _ref14$0$args[0],\n          value = _ref14[1];\n\n      return [accountId, isVoter(value) ? {\n        stake: value.stake,\n        votes: value.votes\n      } : {\n        stake: value[0],\n        votes: value[1]\n      }];\n    });\n  }));\n}\n\nexport function votes(instanceId, api) {\n  var elections = api.query.phragmenElection || api.query.electionsPhragmen || api.query.elections;\n  return memo(instanceId, function () {\n    return elections ? elections.stakeOf ? retrievePrev(api, elections) : retrieveCurrent(elections) : of([]);\n  });\n}","map":{"version":3,"sources":["/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/@polkadot/api-derive/council/votes.js"],"names":["combineLatest","map","of","memo","isVoter","value","Array","isArray","retrieveStakeOf","elections","stakeOf","entries","pipe","args","accountId","stake","retrieveVoteOf","votesOf","votes","retrievePrev","api","stakes","result","forEach","voter","push","registry","createType","staker","entry","find","eq","retrieveCurrent","voting","instanceId","query","phragmenElection","electionsPhragmen"],"mappings":"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","sourcesContent":["// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of } from 'rxjs';\nimport { memo } from \"../util/index.js\"; // Voter is current tuple is 2.x-era\n\nfunction isVoter(value) {\n  return !Array.isArray(value);\n}\n\nfunction retrieveStakeOf(elections) {\n  return elections.stakeOf.entries().pipe(map(entries => entries.map(([{\n    args: [accountId]\n  }, stake]) => [accountId, stake])));\n}\n\nfunction retrieveVoteOf(elections) {\n  return elections.votesOf.entries().pipe(map(entries => entries.map(([{\n    args: [accountId]\n  }, votes]) => [accountId, votes])));\n}\n\nfunction retrievePrev(api, elections) {\n  return combineLatest([retrieveStakeOf(elections), retrieveVoteOf(elections)]).pipe(map(([stakes, votes]) => {\n    const result = [];\n    votes.forEach(([voter, votes]) => {\n      result.push([voter, {\n        stake: api.registry.createType('Balance'),\n        votes\n      }]);\n    });\n    stakes.forEach(([staker, stake]) => {\n      const entry = result.find(([voter]) => voter.eq(staker));\n\n      if (entry) {\n        entry[1].stake = stake;\n      } else {\n        result.push([staker, {\n          stake,\n          votes: []\n        }]);\n      }\n    });\n    return result;\n  }));\n}\n\nfunction retrieveCurrent(elections) {\n  return elections.voting.entries().pipe(map(entries => entries.map(([{\n    args: [accountId]\n  }, value]) => [accountId, isVoter(value) ? {\n    stake: value.stake,\n    votes: value.votes\n  } : {\n    stake: value[0],\n    votes: value[1]\n  }])));\n}\n\nexport function votes(instanceId, api) {\n  const elections = api.query.phragmenElection || api.query.electionsPhragmen || api.query.elections;\n  return memo(instanceId, () => elections ? elections.stakeOf ? retrievePrev(api, elections) : retrieveCurrent(elections) : of([]));\n}"]},"metadata":{},"sourceType":"module"}