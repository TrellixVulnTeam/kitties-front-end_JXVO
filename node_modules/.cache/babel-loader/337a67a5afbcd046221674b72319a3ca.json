{"ast":null,"code":"import _regeneratorRuntime from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _classPrivateFieldLooseBase from \"@babel/runtime/helpers/esm/classPrivateFieldLooseBase\";\nimport _classPrivateFieldLooseKey from \"@babel/runtime/helpers/esm/classPrivateFieldLooseKey\"; // Copyright 2017-2021 @polkadot/hw-ledger authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport { transports } from '@polkadot/hw-ledger-transports';\nimport { assert, u8aToBuffer } from '@polkadot/util';\nimport { LEDGER_DEFAULT_ACCOUNT, LEDGER_DEFAULT_CHANGE, LEDGER_DEFAULT_INDEX, LEDGER_SUCCESS_CODE } from \"./constants.js\";\nimport { ledgerApps } from \"./defaults.js\";\nexport { packageInfo } from \"./packageInfo.js\";\n\nvar _app = /*#__PURE__*/_classPrivateFieldLooseKey(\"app\");\n\nvar _chain = /*#__PURE__*/_classPrivateFieldLooseKey(\"chain\");\n\nvar _transport = /*#__PURE__*/_classPrivateFieldLooseKey(\"transport\");\n\nvar _getApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"getApp\");\n\nvar _withApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"withApp\");\n\nvar _wrapError = /*#__PURE__*/_classPrivateFieldLooseKey(\"wrapError\"); // A very basic wrapper for a ledger app -\n//  - it connects automatically, creating an app as required\n//  - Promises return errors (instead of wrapper errors)\n\n\nexport var Ledger = /*#__PURE__*/function () {\n  function Ledger(_transport2, chain) {\n    var _this = this;\n\n    _classCallCheck(this, Ledger);\n\n    Object.defineProperty(this, _app, {\n      writable: true,\n      value: null\n    });\n    Object.defineProperty(this, _chain, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _transport, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _getApp, {\n      writable: true,\n      value: function () {\n        var _value = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var def, transport;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (_classPrivateFieldLooseBase(_this, _app)[_app]) {\n                    _context.next = 7;\n                    break;\n                  }\n\n                  def = transports.find(function (_ref) {\n                    var type = _ref.type;\n                    return type === _classPrivateFieldLooseBase(_this, _transport)[_transport];\n                  });\n                  assert(def, function () {\n                    return \"Unable to find a transport for \".concat(_classPrivateFieldLooseBase(_this, _transport)[_transport]);\n                  });\n                  _context.next = 5;\n                  return def.create();\n\n                case 5:\n                  transport = _context.sent;\n                  _classPrivateFieldLooseBase(_this, _app)[_app] = ledgerApps[_classPrivateFieldLooseBase(_this, _chain)[_chain]](transport);\n\n                case 7:\n                  return _context.abrupt(\"return\", _classPrivateFieldLooseBase(_this, _app)[_app]);\n\n                case 8:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function value() {\n          return _value.apply(this, arguments);\n        }\n\n        return value;\n      }()\n    });\n    Object.defineProperty(this, _withApp, {\n      writable: true,\n      value: function () {\n        var _value2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(fn) {\n          var app;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.prev = 0;\n                  _context2.next = 3;\n                  return _classPrivateFieldLooseBase(_this, _getApp)[_getApp]();\n\n                case 3:\n                  app = _context2.sent;\n                  _context2.next = 6;\n                  return fn(app);\n\n                case 6:\n                  return _context2.abrupt(\"return\", _context2.sent);\n\n                case 9:\n                  _context2.prev = 9;\n                  _context2.t0 = _context2[\"catch\"](0);\n                  _classPrivateFieldLooseBase(_this, _app)[_app] = null;\n                  throw _context2.t0;\n\n                case 13:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, null, [[0, 9]]);\n        }));\n\n        function value(_x) {\n          return _value2.apply(this, arguments);\n        }\n\n        return value;\n      }()\n    });\n    Object.defineProperty(this, _wrapError, {\n      writable: true,\n      value: function () {\n        var _value3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(promise) {\n          var result;\n          return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  _context3.next = 2;\n                  return promise;\n\n                case 2:\n                  result = _context3.sent;\n                  assert(result.return_code === LEDGER_SUCCESS_CODE, function () {\n                    return result.error_message;\n                  });\n                  return _context3.abrupt(\"return\", result);\n\n                case 5:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3);\n        }));\n\n        function value(_x2) {\n          return _value3.apply(this, arguments);\n        }\n\n        return value;\n      }()\n    }); // u2f is deprecated\n\n    assert(['hid', 'webusb'].includes(_transport2), function () {\n      return \"Unsupported transport \".concat(_transport2);\n    });\n    assert(Object.keys(ledgerApps).includes(chain), function () {\n      return \"Unsupported chain \".concat(chain);\n    });\n    _classPrivateFieldLooseBase(this, _chain)[_chain] = chain;\n    _classPrivateFieldLooseBase(this, _transport)[_transport] = _transport2;\n  }\n\n  _createClass(Ledger, [{\n    key: \"getAddress\",\n    value: function () {\n      var _getAddress = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var _this2 = this;\n\n        var confirm,\n            accountOffset,\n            addressOffset,\n            _ref2,\n            _ref2$account,\n            account,\n            _ref2$addressIndex,\n            addressIndex,\n            _ref2$change,\n            change,\n            _args5 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                confirm = _args5.length > 0 && _args5[0] !== undefined ? _args5[0] : false;\n                accountOffset = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : 0;\n                addressOffset = _args5.length > 2 && _args5[2] !== undefined ? _args5[2] : 0;\n                _ref2 = _args5.length > 3 && _args5[3] !== undefined ? _args5[3] : {}, _ref2$account = _ref2.account, account = _ref2$account === void 0 ? LEDGER_DEFAULT_ACCOUNT : _ref2$account, _ref2$addressIndex = _ref2.addressIndex, addressIndex = _ref2$addressIndex === void 0 ? LEDGER_DEFAULT_INDEX : _ref2$addressIndex, _ref2$change = _ref2.change, change = _ref2$change === void 0 ? LEDGER_DEFAULT_CHANGE : _ref2$change;\n                return _context5.abrupt(\"return\", _classPrivateFieldLooseBase(this, _withApp)[_withApp]( /*#__PURE__*/function () {\n                  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(app) {\n                    var _yield$_classPrivateF, address, pubKey;\n\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            _context4.next = 2;\n                            return _classPrivateFieldLooseBase(_this2, _wrapError)[_wrapError](app.getAddress(account + accountOffset, change, addressIndex + addressOffset, confirm));\n\n                          case 2:\n                            _yield$_classPrivateF = _context4.sent;\n                            address = _yield$_classPrivateF.address;\n                            pubKey = _yield$_classPrivateF.pubKey;\n                            return _context4.abrupt(\"return\", {\n                              address: address,\n                              publicKey: \"0x\".concat(pubKey)\n                            });\n\n                          case 6:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n\n                  return function (_x3) {\n                    return _ref3.apply(this, arguments);\n                  };\n                }()));\n\n              case 5:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function getAddress() {\n        return _getAddress.apply(this, arguments);\n      }\n\n      return getAddress;\n    }()\n  }, {\n    key: \"getVersion\",\n    value: function () {\n      var _getVersion = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        var _this3 = this;\n\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                return _context7.abrupt(\"return\", _classPrivateFieldLooseBase(this, _withApp)[_withApp]( /*#__PURE__*/function () {\n                  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(app) {\n                    var _yield$_classPrivateF2, isLocked, major, minor, patch, isTestMode;\n\n                    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                      while (1) {\n                        switch (_context6.prev = _context6.next) {\n                          case 0:\n                            _context6.next = 2;\n                            return _classPrivateFieldLooseBase(_this3, _wrapError)[_wrapError](app.getVersion());\n\n                          case 2:\n                            _yield$_classPrivateF2 = _context6.sent;\n                            isLocked = _yield$_classPrivateF2.device_locked;\n                            major = _yield$_classPrivateF2.major;\n                            minor = _yield$_classPrivateF2.minor;\n                            patch = _yield$_classPrivateF2.patch;\n                            isTestMode = _yield$_classPrivateF2.test_mode;\n                            return _context6.abrupt(\"return\", {\n                              isLocked: isLocked,\n                              isTestMode: isTestMode,\n                              version: [major, minor, patch]\n                            });\n\n                          case 9:\n                          case \"end\":\n                            return _context6.stop();\n                        }\n                      }\n                    }, _callee6);\n                  }));\n\n                  return function (_x4) {\n                    return _ref4.apply(this, arguments);\n                  };\n                }()));\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getVersion() {\n        return _getVersion.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(message) {\n        var _this4 = this;\n\n        var accountOffset,\n            addressOffset,\n            _ref5,\n            _ref5$account,\n            account,\n            _ref5$addressIndex,\n            addressIndex,\n            _ref5$change,\n            change,\n            _args9 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                accountOffset = _args9.length > 1 && _args9[1] !== undefined ? _args9[1] : 0;\n                addressOffset = _args9.length > 2 && _args9[2] !== undefined ? _args9[2] : 0;\n                _ref5 = _args9.length > 3 && _args9[3] !== undefined ? _args9[3] : {}, _ref5$account = _ref5.account, account = _ref5$account === void 0 ? LEDGER_DEFAULT_ACCOUNT : _ref5$account, _ref5$addressIndex = _ref5.addressIndex, addressIndex = _ref5$addressIndex === void 0 ? LEDGER_DEFAULT_INDEX : _ref5$addressIndex, _ref5$change = _ref5.change, change = _ref5$change === void 0 ? LEDGER_DEFAULT_CHANGE : _ref5$change;\n                return _context9.abrupt(\"return\", _classPrivateFieldLooseBase(this, _withApp)[_withApp]( /*#__PURE__*/function () {\n                  var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(app) {\n                    var buffer, _yield$_classPrivateF3, signature;\n\n                    return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                      while (1) {\n                        switch (_context8.prev = _context8.next) {\n                          case 0:\n                            buffer = u8aToBuffer(message);\n                            _context8.next = 3;\n                            return _classPrivateFieldLooseBase(_this4, _wrapError)[_wrapError](app.sign(account + accountOffset, change, addressIndex + addressOffset, buffer));\n\n                          case 3:\n                            _yield$_classPrivateF3 = _context8.sent;\n                            signature = _yield$_classPrivateF3.signature;\n                            return _context8.abrupt(\"return\", {\n                              signature: \"0x\".concat(signature.toString('hex'))\n                            });\n\n                          case 6:\n                          case \"end\":\n                            return _context8.stop();\n                        }\n                      }\n                    }, _callee8);\n                  }));\n\n                  return function (_x6) {\n                    return _ref6.apply(this, arguments);\n                  };\n                }()));\n\n              case 4:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function sign(_x5) {\n        return _sign.apply(this, arguments);\n      }\n\n      return sign;\n    }()\n  }]);\n\n  return Ledger;\n}();","map":{"version":3,"sources":["/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/@polkadot/hw-ledger/bundle.js"],"names":["_classPrivateFieldLooseBase","_classPrivateFieldLooseKey","transports","assert","u8aToBuffer","LEDGER_DEFAULT_ACCOUNT","LEDGER_DEFAULT_CHANGE","LEDGER_DEFAULT_INDEX","LEDGER_SUCCESS_CODE","ledgerApps","packageInfo","_app","_chain","_transport","_getApp","_withApp","_wrapError","Ledger","_transport2","chain","Object","defineProperty","writable","value","def","find","type","create","transport","fn","app","promise","result","return_code","error_message","includes","keys","confirm","accountOffset","addressOffset","account","addressIndex","change","getAddress","address","pubKey","publicKey","getVersion","isLocked","device_locked","major","minor","patch","isTestMode","test_mode","version","message","buffer","sign","signature","toString"],"mappings":"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","sourcesContent":["import _classPrivateFieldLooseBase from \"@babel/runtime/helpers/esm/classPrivateFieldLooseBase\";\nimport _classPrivateFieldLooseKey from \"@babel/runtime/helpers/esm/classPrivateFieldLooseKey\";\n// Copyright 2017-2021 @polkadot/hw-ledger authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { transports } from '@polkadot/hw-ledger-transports';\nimport { assert, u8aToBuffer } from '@polkadot/util';\nimport { LEDGER_DEFAULT_ACCOUNT, LEDGER_DEFAULT_CHANGE, LEDGER_DEFAULT_INDEX, LEDGER_SUCCESS_CODE } from \"./constants.js\";\nimport { ledgerApps } from \"./defaults.js\";\nexport { packageInfo } from \"./packageInfo.js\";\n\nvar _app = /*#__PURE__*/_classPrivateFieldLooseKey(\"app\");\n\nvar _chain = /*#__PURE__*/_classPrivateFieldLooseKey(\"chain\");\n\nvar _transport = /*#__PURE__*/_classPrivateFieldLooseKey(\"transport\");\n\nvar _getApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"getApp\");\n\nvar _withApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"withApp\");\n\nvar _wrapError = /*#__PURE__*/_classPrivateFieldLooseKey(\"wrapError\");\n\n// A very basic wrapper for a ledger app -\n//  - it connects automatically, creating an app as required\n//  - Promises return errors (instead of wrapper errors)\nexport class Ledger {\n  constructor(_transport2, chain) {\n    Object.defineProperty(this, _app, {\n      writable: true,\n      value: null\n    });\n    Object.defineProperty(this, _chain, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _transport, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _getApp, {\n      writable: true,\n      value: async () => {\n        if (!_classPrivateFieldLooseBase(this, _app)[_app]) {\n          const def = transports.find(({\n            type\n          }) => type === _classPrivateFieldLooseBase(this, _transport)[_transport]);\n          assert(def, () => `Unable to find a transport for ${_classPrivateFieldLooseBase(this, _transport)[_transport]}`);\n          const transport = await def.create();\n          _classPrivateFieldLooseBase(this, _app)[_app] = ledgerApps[_classPrivateFieldLooseBase(this, _chain)[_chain]](transport);\n        }\n\n        return _classPrivateFieldLooseBase(this, _app)[_app];\n      }\n    });\n    Object.defineProperty(this, _withApp, {\n      writable: true,\n      value: async fn => {\n        try {\n          const app = await _classPrivateFieldLooseBase(this, _getApp)[_getApp]();\n          return await fn(app);\n        } catch (error) {\n          _classPrivateFieldLooseBase(this, _app)[_app] = null;\n          throw error;\n        }\n      }\n    });\n    Object.defineProperty(this, _wrapError, {\n      writable: true,\n      value: async promise => {\n        const result = await promise;\n        assert(result.return_code === LEDGER_SUCCESS_CODE, () => result.error_message);\n        return result;\n      }\n    });\n    // u2f is deprecated\n    assert(['hid', 'webusb'].includes(_transport2), () => `Unsupported transport ${_transport2}`);\n    assert(Object.keys(ledgerApps).includes(chain), () => `Unsupported chain ${chain}`);\n    _classPrivateFieldLooseBase(this, _chain)[_chain] = chain;\n    _classPrivateFieldLooseBase(this, _transport)[_transport] = _transport2;\n  }\n\n  async getAddress(confirm = false, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const {\n        address,\n        pubKey\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.getAddress(account + accountOffset, change, addressIndex + addressOffset, confirm));\n      return {\n        address,\n        publicKey: `0x${pubKey}`\n      };\n    });\n  }\n\n  async getVersion() {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const {\n        device_locked: isLocked,\n        major,\n        minor,\n        patch,\n        test_mode: isTestMode\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.getVersion());\n      return {\n        isLocked,\n        isTestMode,\n        version: [major, minor, patch]\n      };\n    });\n  }\n\n  async sign(message, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const buffer = u8aToBuffer(message);\n      const {\n        signature\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.sign(account + accountOffset, change, addressIndex + addressOffset, buffer));\n      return {\n        signature: `0x${signature.toString('hex')}`\n      };\n    });\n  }\n\n}"]},"metadata":{},"sourceType":"module"}