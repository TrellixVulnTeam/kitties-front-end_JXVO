{"ast":null,"code":"import _toArray from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toArray\";\nimport _toConsumableArray from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n} // Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { assert, isFunction } from '@polkadot/util';\nimport { memo } from \"../util/index.js\";\n\nfunction zeroBalance(api) {\n  return api.registry.createType('Balance');\n}\n\nfunction getBalance(api, _ref) {\n  var _ref2 = _slicedToArray(_ref, 4),\n      freeBalance = _ref2[0],\n      reservedBalance = _ref2[1],\n      frozenFee = _ref2[2],\n      frozenMisc = _ref2[3];\n\n  var votingBalance = api.registry.createType('Balance', freeBalance.toBn());\n  return {\n    freeBalance: freeBalance,\n    frozenFee: frozenFee,\n    frozenMisc: frozenMisc,\n    reservedBalance: reservedBalance,\n    votingBalance: votingBalance\n  };\n}\n\nfunction calcBalances(api, _ref3) {\n  var _ref4 = _slicedToArray(_ref3, 2),\n      accountId = _ref4[0],\n      _ref4$ = _slicedToArray(_ref4[1], 2),\n      accountNonce = _ref4$[0],\n      balances = _ref4$[1];\n\n  var primary = balances[0];\n  assert(primary, 'No balances retrieved for account');\n  return _objectSpread({\n    accountId: accountId,\n    accountNonce: accountNonce,\n    additional: balances.filter(function (_, index) {\n      return index !== 0;\n    }).map(function (b) {\n      return getBalance(api, b);\n    })\n  }, getBalance(api, primary));\n} // old\n\n\nfunction queryBalancesFree(api, accountId) {\n  return api.queryMulti([[api.query.balances.freeBalance, accountId], [api.query.balances.reservedBalance, accountId], [api.query.system.accountNonce, accountId]]).pipe(map(function (_ref5) {\n    var _ref6 = _slicedToArray(_ref5, 3),\n        freeBalance = _ref6[0],\n        reservedBalance = _ref6[1],\n        accountNonce = _ref6[2];\n\n    return [accountNonce, [[freeBalance, reservedBalance, zeroBalance(api), zeroBalance(api)]]];\n  }));\n}\n\nfunction querySystemNonce(api, accountId) {\n  return api.query.system.accountNonce(accountId).pipe(map(function (accountNonce) {\n    return [accountNonce, [[zeroBalance(api), zeroBalance(api), zeroBalance(api), zeroBalance(api)]]];\n  }));\n}\n\nfunction queryBalancesAccount(api, accountId) {\n  var modules = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ['balances'];\n  var balances = modules.map(function (m) {\n    var _m;\n\n    return [((_m = api.derive[m]) === null || _m === void 0 ? void 0 : _m.customAccount) || api.query[m].account, accountId];\n  });\n\n  var extract = function extract(data) {\n    return data.map(function (_ref7) {\n      var feeFrozen = _ref7.feeFrozen,\n          free = _ref7.free,\n          miscFrozen = _ref7.miscFrozen,\n          reserved = _ref7.reserved;\n      return [free, reserved, feeFrozen, miscFrozen];\n    });\n  }; // NOTE this is for the first case where we do have instances specified\n\n\n  return isFunction(api.query.system.account) ? api.queryMulti([[api.query.system.account, accountId]].concat(_toConsumableArray(balances))).pipe(map(function (_ref8) {\n    var _ref9 = _toArray(_ref8),\n        nonce = _ref9[0].nonce,\n        balances = _ref9.slice(1);\n\n    return [nonce, extract(balances)];\n  })) : api.queryMulti([[api.query.system.accountNonce, accountId]].concat(_toConsumableArray(balances))).pipe(map(function (_ref10) {\n    var _ref11 = _toArray(_ref10),\n        nonce = _ref11[0],\n        balances = _ref11.slice(1);\n\n    return [nonce, extract(balances)];\n  }));\n}\n\nfunction querySystemAccount(api, accountId) {\n  // AccountInfo is current, support old, eg. Edgeware\n  return api.query.system.account(accountId).pipe(map(function (infoOrTuple) {\n    var data = infoOrTuple.nonce ? infoOrTuple.data : infoOrTuple[1];\n    var nonce = infoOrTuple.nonce || infoOrTuple[0];\n\n    if (!data || data.isEmpty) {\n      return [nonce, [[zeroBalance(api), zeroBalance(api), zeroBalance(api), zeroBalance(api)]]];\n    }\n\n    var feeFrozen = data.feeFrozen,\n        free = data.free,\n        miscFrozen = data.miscFrozen,\n        reserved = data.reserved;\n    return [nonce, [[free, reserved, feeFrozen, miscFrozen]]];\n  }));\n}\n/**\n * @name account\n * @param {( AccountIndex | AccountId | Address | string )} address - An accounts Id in different formats.\n * @returns An object containing the results of various balance queries\n * @example\n * <BR>\n *\n * ```javascript\n * const ALICE = 'F7Hs';\n *\n * api.derive.balances.all(ALICE, ({ accountId, lockedBalance }) => {\n *   console.log(`The account ${accountId} has a locked balance ${lockedBalance} units.`);\n * });\n * ```\n */\n\n\nexport function account(instanceId, api) {\n  var balanceInstances = api.registry.getModuleInstances(api.runtimeVersion.specName.toString(), 'balances');\n  var empty = [api.registry.createType('Index'), [[zeroBalance(api), zeroBalance(api), zeroBalance(api), zeroBalance(api)]]];\n  return memo(instanceId, function (address) {\n    return api.derive.accounts.accountId(address).pipe(switchMap(function (accountId) {\n      var _api$query$system, _api$query$balances, _api$query$balances2, _api$query$system2;\n\n      return accountId ? combineLatest([of(accountId), balanceInstances ? queryBalancesAccount(api, accountId, balanceInstances) : isFunction((_api$query$system = api.query.system) === null || _api$query$system === void 0 ? void 0 : _api$query$system.account) ? querySystemAccount(api, accountId) : isFunction((_api$query$balances = api.query.balances) === null || _api$query$balances === void 0 ? void 0 : _api$query$balances.account) ? queryBalancesAccount(api, accountId) : isFunction((_api$query$balances2 = api.query.balances) === null || _api$query$balances2 === void 0 ? void 0 : _api$query$balances2.freeBalance) ? queryBalancesFree(api, accountId) : isFunction((_api$query$system2 = api.query.system) === null || _api$query$system2 === void 0 ? void 0 : _api$query$system2.accountNonce) ? querySystemNonce(api, accountId) : of(empty)]) : of([api.registry.createType('AccountId'), empty]);\n    }), map(function (result) {\n      return calcBalances(api, result);\n    }));\n  });\n}","map":{"version":3,"sources":["/home/spren/workspace/slides/advanced/term-03/03_polkadot-js-api/kitties/frontend/node_modules/@polkadot/api-derive/balances/account.js"],"names":["_defineProperty","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","combineLatest","map","of","switchMap","assert","isFunction","memo","zeroBalance","api","registry","createType","getBalance","freeBalance","reservedBalance","frozenFee","frozenMisc","votingBalance","toBn","calcBalances","accountId","accountNonce","balances","primary","additional","_","index","b","queryBalancesFree","queryMulti","query","system","pipe","querySystemNonce","queryBalancesAccount","modules","m","_m","derive","customAccount","account","extract","data","feeFrozen","free","miscFrozen","reserved","nonce","querySystemAccount","infoOrTuple","isEmpty","instanceId","balanceInstances","getModuleInstances","runtimeVersion","specName","toString","empty","address","accounts","_api$query$system","_api$query$balances","_api$query$balances2","_api$query$system2","result"],"mappings":"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","sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { assert, isFunction } from '@polkadot/util';\nimport { memo } from \"../util/index.js\";\n\nfunction zeroBalance(api) {\n  return api.registry.createType('Balance');\n}\n\nfunction getBalance(api, [freeBalance, reservedBalance, frozenFee, frozenMisc]) {\n  const votingBalance = api.registry.createType('Balance', freeBalance.toBn());\n  return {\n    freeBalance,\n    frozenFee,\n    frozenMisc,\n    reservedBalance,\n    votingBalance\n  };\n}\n\nfunction calcBalances(api, [accountId, [accountNonce, balances]]) {\n  const primary = balances[0];\n  assert(primary, 'No balances retrieved for account');\n  return _objectSpread({\n    accountId,\n    accountNonce,\n    additional: balances.filter((_, index) => index !== 0).map(b => getBalance(api, b))\n  }, getBalance(api, primary));\n} // old\n\n\nfunction queryBalancesFree(api, accountId) {\n  return api.queryMulti([[api.query.balances.freeBalance, accountId], [api.query.balances.reservedBalance, accountId], [api.query.system.accountNonce, accountId]]).pipe(map(([freeBalance, reservedBalance, accountNonce]) => [accountNonce, [[freeBalance, reservedBalance, zeroBalance(api), zeroBalance(api)]]]));\n}\n\nfunction querySystemNonce(api, accountId) {\n  return api.query.system.accountNonce(accountId).pipe(map(accountNonce => [accountNonce, [[zeroBalance(api), zeroBalance(api), zeroBalance(api), zeroBalance(api)]]]));\n}\n\nfunction queryBalancesAccount(api, accountId, modules = ['balances']) {\n  const balances = modules.map(m => {\n    var _m;\n\n    return [((_m = api.derive[m]) === null || _m === void 0 ? void 0 : _m.customAccount) || api.query[m].account, accountId];\n  });\n\n  const extract = data => data.map(({\n    feeFrozen,\n    free,\n    miscFrozen,\n    reserved\n  }) => [free, reserved, feeFrozen, miscFrozen]); // NOTE this is for the first case where we do have instances specified\n\n\n  return isFunction(api.query.system.account) ? api.queryMulti([[api.query.system.account, accountId], ...balances]).pipe(map(([{\n    nonce\n  }, ...balances]) => [nonce, extract(balances)])) : api.queryMulti([[api.query.system.accountNonce, accountId], ...balances]).pipe(map(([nonce, ...balances]) => [nonce, extract(balances)]));\n}\n\nfunction querySystemAccount(api, accountId) {\n  // AccountInfo is current, support old, eg. Edgeware\n  return api.query.system.account(accountId).pipe(map(infoOrTuple => {\n    const data = infoOrTuple.nonce ? infoOrTuple.data : infoOrTuple[1];\n    const nonce = infoOrTuple.nonce || infoOrTuple[0];\n\n    if (!data || data.isEmpty) {\n      return [nonce, [[zeroBalance(api), zeroBalance(api), zeroBalance(api), zeroBalance(api)]]];\n    }\n\n    const {\n      feeFrozen,\n      free,\n      miscFrozen,\n      reserved\n    } = data;\n    return [nonce, [[free, reserved, feeFrozen, miscFrozen]]];\n  }));\n}\n/**\n * @name account\n * @param {( AccountIndex | AccountId | Address | string )} address - An accounts Id in different formats.\n * @returns An object containing the results of various balance queries\n * @example\n * <BR>\n *\n * ```javascript\n * const ALICE = 'F7Hs';\n *\n * api.derive.balances.all(ALICE, ({ accountId, lockedBalance }) => {\n *   console.log(`The account ${accountId} has a locked balance ${lockedBalance} units.`);\n * });\n * ```\n */\n\n\nexport function account(instanceId, api) {\n  const balanceInstances = api.registry.getModuleInstances(api.runtimeVersion.specName.toString(), 'balances');\n  const empty = [api.registry.createType('Index'), [[zeroBalance(api), zeroBalance(api), zeroBalance(api), zeroBalance(api)]]];\n  return memo(instanceId, address => api.derive.accounts.accountId(address).pipe(switchMap(accountId => {\n    var _api$query$system, _api$query$balances, _api$query$balances2, _api$query$system2;\n\n    return accountId ? combineLatest([of(accountId), balanceInstances ? queryBalancesAccount(api, accountId, balanceInstances) : isFunction((_api$query$system = api.query.system) === null || _api$query$system === void 0 ? void 0 : _api$query$system.account) ? querySystemAccount(api, accountId) : isFunction((_api$query$balances = api.query.balances) === null || _api$query$balances === void 0 ? void 0 : _api$query$balances.account) ? queryBalancesAccount(api, accountId) : isFunction((_api$query$balances2 = api.query.balances) === null || _api$query$balances2 === void 0 ? void 0 : _api$query$balances2.freeBalance) ? queryBalancesFree(api, accountId) : isFunction((_api$query$system2 = api.query.system) === null || _api$query$system2 === void 0 ? void 0 : _api$query$system2.accountNonce) ? querySystemNonce(api, accountId) : of(empty)]) : of([api.registry.createType('AccountId'), empty]);\n  }), map(result => calcBalances(api, result))));\n}"]},"metadata":{},"sourceType":"module"}